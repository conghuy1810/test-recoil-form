var fpweb=function(q){"use strict";var T;(function(e){e[e.Document=0]="Document",e[e.DocumentType=1]="DocumentType",e[e.Element=2]="Element",e[e.Text=3]="Text",e[e.CDATA=4]="CDATA",e[e.Comment=5]="Comment"})(T||(T={}));function Bt(e){return e.nodeType===e.ELEMENT_NODE}function _e(e){const t=e?.host;return Boolean(t?.shadowRoot===e)}function Fe(e){return Object.prototype.toString.call(e)==="[object ShadowRoot]"}function mr(e){return e.includes(" background-clip: text;")&&!e.includes(" -webkit-background-clip: text;")&&(e=e.replace(" background-clip: text;"," -webkit-background-clip: text; background-clip: text;")),e}function fr(e){const{cssText:t}=e;if(t.split('"').length<3)return t;const n=["@import",`url(${JSON.stringify(e.href)})`];return e.layerName===""?n.push("layer"):e.layerName&&n.push(`layer(${e.layerName})`),e.supportsText&&n.push(`supports(${e.supportsText})`),e.media.length&&n.push(e.media.mediaText),n.join(" ")+";"}function He(e){try{const t=e.rules||e.cssRules;return t?mr(Array.from(t,jt).join("")):null}catch{return null}}function jt(e){let t;if(gr(e))try{t=He(e.styleSheet)||fr(e)}catch{}else if(vr(e)&&e.selectorText.includes(":"))return yr(e.cssText);return t||e.cssText}function yr(e){const t=/(\[(?:[\w-]+)[^\\])(:(?:[\w-]+)\])/gm;return e.replace(t,"$1\\$2")}function gr(e){return"styleSheet"in e}function vr(e){return"selectorText"in e}class ct{constructor(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap}getId(t){var n;if(!t)return-1;const r=(n=this.getMeta(t))===null||n===void 0?void 0:n.id;return r??-1}getNode(t){return this.idNodeMap.get(t)||null}getIds(){return Array.from(this.idNodeMap.keys())}getMeta(t){return this.nodeMetaMap.get(t)||null}removeNodeFromMap(t){const n=this.getId(t);this.idNodeMap.delete(n),t.childNodes&&t.childNodes.forEach(r=>this.removeNodeFromMap(r))}has(t){return this.idNodeMap.has(t)}hasNode(t){return this.nodeMetaMap.has(t)}add(t,n){const r=n.id;this.idNodeMap.set(r,t),this.nodeMetaMap.set(t,n)}replace(t,n){const r=this.getNode(t);if(r){const o=this.nodeMetaMap.get(r);o&&this.nodeMetaMap.set(n,o)}this.idNodeMap.set(t,n)}reset(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap}}function Vt(){return new ct}function ut({element:e,maskInputOptions:t,tagName:n,type:r,value:o,maskInputFn:l}){let i=o||"";const s=r&&pe(r);return(t[n.toLowerCase()]||s&&t[s])&&(l?i=l(i,e):i="*".repeat(i.length)),i}function pe(e){return e.toLowerCase()}const zt="__fpweb_original__";function Sr(e){const t=e.getContext("2d");if(!t)return!0;const n=50;for(let r=0;r<e.width;r+=n)for(let o=0;o<e.height;o+=n){const l=t.getImageData,i=zt in l?l[zt]:l;if(new Uint32Array(i.call(t,r,o,Math.min(n,e.width-r),Math.min(n,e.height-o)).data.buffer).some(s=>s!==0))return!1}return!0}function br(e,t){return!e||!t||e.type!==t.type?!1:e.type===T.Document?e.compatMode===t.compatMode:e.type===T.DocumentType?e.name===t.name&&e.publicId===t.publicId&&e.systemId===t.systemId:e.type===T.Comment||e.type===T.Text||e.type===T.CDATA?e.textContent===t.textContent:e.type===T.Element?e.tagName===t.tagName&&JSON.stringify(e.attributes)===JSON.stringify(t.attributes)&&e.isSVG===t.isSVG&&e.needBlock===t.needBlock:!1}function dt(e){const t=e.type;return e.hasAttribute("data-rr-is-password")?"password":t?pe(t):null}let wr=1;const Er=new RegExp("[^a-z0-9-_:]"),Pe=-2;function Ht(){return wr++}function Cr(e){if(e instanceof HTMLFormElement)return"form";const t=pe(e.tagName);return Er.test(t)?"div":t}function Mr(e){let t="";return e.indexOf("//")>-1?t=e.split("/").slice(0,3).join("/"):t=e.split("/")[0],t=t.split("?")[0],t}let Ce,Gt;const Tr=/url\((?:(')([^']*)'|(")(.*?)"|([^)]*))\)/gm,Nr=/^(?:[a-z+]+:)?\/\//i,Ir=/^www\..*/i,Dr=/^(data:)([^,]*),(.*)/i;function Ge(e,t){return(e||"").replace(Tr,(n,r,o,l,i,s)=>{const a=o||i||s,c=r||l||"";if(!a)return n;if(Nr.test(a)||Ir.test(a))return`url(${c}${a}${c})`;if(Dr.test(a))return`url(${c}${a}${c})`;if(a[0]==="/")return`url(${c}${Mr(t)+a}${c})`;const u=t.split("/"),d=a.split("/");u.pop();for(const h of d)h!=="."&&(h===".."?u.pop():u.push(h));return`url(${c}${u.join("/")}${c})`})}const kr=/^[^ \t\n\r\u000c]+/,Rr=/^[, \t\n\r\u000c]+/;function Or(e,t){if(t.trim()==="")return t;let n=0;function r(l){let i;const s=l.exec(t.substring(n));return s?(i=s[0],n+=i.length,i):""}const o=[];for(;r(Rr),!(n>=t.length);){let l=r(kr);if(l.slice(-1)===",")l=Ye(e,l.substring(0,l.length-1)),o.push(l);else{let i="";l=Ye(e,l);let s=!1;for(;;){const a=t.charAt(n);if(a===""){o.push((l+i).trim());break}else if(s)a===")"&&(s=!1);else if(a===","){n+=1,o.push((l+i).trim());break}else a==="("&&(s=!0);i+=a,n+=1}}}return o.join(", ")}function Ye(e,t){if(!t||t.trim()==="")return t;const n=e.createElement("a");return n.href=t,n.href}function xr(e){return Boolean(e.tagName==="svg"||e.ownerSVGElement)}function ht(){const e=document.createElement("a");return e.href="",e.href}function Yt(e,t,n,r){return r&&(n==="src"||n==="href"&&!(t==="use"&&r[0]==="#")||n==="xlink:href"&&r[0]!=="#"||n==="background"&&(t==="table"||t==="td"||t==="th")?Ye(e,r):n==="srcset"?Or(e,r):n==="style"?Ge(r,ht()):t==="object"&&n==="data"?Ye(e,r):r)}function Xt(e,t,n){return(e==="video"||e==="audio")&&t==="autoplay"}function Ar(e,t,n){try{if(typeof t=="string"){if(e.classList.contains(t))return!0}else for(let r=e.classList.length;r--;){const o=e.classList[r];if(t.test(o))return!0}if(n)return e.matches(n)}catch{}return!1}function Xe(e,t,n){if(!e)return!1;if(e.nodeType!==e.ELEMENT_NODE)return n?Xe(e.parentNode,t,n):!1;for(let r=e.classList.length;r--;){const o=e.classList[r];if(t.test(o))return!0}return n?Xe(e.parentNode,t,n):!1}function qt(e,t,n,r){try{const o=e.nodeType===e.ELEMENT_NODE?e:e.parentElement;if(o===null)return!1;if(typeof t=="string"){if(r){if(o.closest(`.${t}`))return!0}else if(o.classList.contains(t))return!0}else if(Xe(o,t,r))return!0;if(n){if(r){if(o.closest(n))return!0}else if(o.matches(n))return!0}}catch{}return!1}function Lr(e,t,n){const r=e.contentWindow;if(!r)return;let o=!1,l;try{l=r.document.readyState}catch{return}if(l!=="complete"){const s=setTimeout(()=>{o||(t(),o=!0)},n);e.addEventListener("load",()=>{clearTimeout(s),o=!0,t()});return}const i="about:blank";if(r.location.href!==i||e.src===i||e.src==="")return setTimeout(t,0),e.addEventListener("load",t);e.addEventListener("load",t)}function _r(e,t,n){let r=!1,o;try{o=e.sheet}catch{return}if(o)return;const l=setTimeout(()=>{r||(t(),r=!0)},n);e.addEventListener("load",()=>{clearTimeout(l),r=!0,t()})}function Fr(e,t){const{doc:n,mirror:r,blockClass:o,blockSelector:l,needsMask:i,inlineStylesheet:s,maskInputOptions:a={},maskTextFn:c,maskInputFn:u,dataURLOptions:d={},inlineImages:h,recordCanvas:m,keepIframeSrcFn:y,newlyAddedElement:p=!1}=t,v=Pr(n,r);switch(e.nodeType){case e.DOCUMENT_NODE:return e.compatMode!=="CSS1Compat"?{type:T.Document,childNodes:[],compatMode:e.compatMode}:{type:T.Document,childNodes:[]};case e.DOCUMENT_TYPE_NODE:return{type:T.DocumentType,name:e.name,publicId:e.publicId,systemId:e.systemId,rootId:v};case e.ELEMENT_NODE:return Ur(e,{doc:n,blockClass:o,blockSelector:l,inlineStylesheet:s,maskInputOptions:a,maskInputFn:u,dataURLOptions:d,inlineImages:h,recordCanvas:m,keepIframeSrcFn:y,newlyAddedElement:p,rootId:v});case e.TEXT_NODE:return $r(e,{needsMask:i,maskTextFn:c,rootId:v});case e.CDATA_SECTION_NODE:return{type:T.CDATA,textContent:"",rootId:v};case e.COMMENT_NODE:return{type:T.Comment,textContent:e.textContent||"",rootId:v};default:return!1}}function Pr(e,t){if(!t.hasNode(e))return;const n=t.getId(e);return n===1?void 0:n}function $r(e,t){var n;const{needsMask:r,maskTextFn:o,rootId:l}=t,i=e.parentNode&&e.parentNode.tagName;let s=e.textContent;const a=i==="STYLE"?!0:void 0,c=i==="SCRIPT"?!0:void 0;if(a&&s){try{e.nextSibling||e.previousSibling||!((n=e.parentNode.sheet)===null||n===void 0)&&n.cssRules&&(s=He(e.parentNode.sheet))}catch(u){console.warn(`Cannot get CSS styles from text's parentNode. Error: ${u}`,e)}s=Ge(s,ht())}return c&&(s="SCRIPT_PLACEHOLDER"),!a&&!c&&s&&r&&(s=o?o(s,e.parentElement):s.replace(/[\S]/g,"*")),{type:T.Text,textContent:s||"",isStyle:a,rootId:l}}function Ur(e,t){const{doc:n,blockClass:r,blockSelector:o,inlineStylesheet:l,maskInputOptions:i={},maskInputFn:s,dataURLOptions:a={},inlineImages:c,recordCanvas:u,keepIframeSrcFn:d,newlyAddedElement:h=!1,rootId:m}=t,y=Ar(e,r,o),p=Cr(e);let v={};const f=e.attributes.length;for(let g=0;g<f;g++){const w=e.attributes[g];Xt(p,w.name,w.value)||(v[w.name]=Yt(n,p,pe(w.name),w.value))}if(p==="link"&&l){const g=Array.from(n.styleSheets).find(N=>N.href===e.href);let w=null;g&&(w=He(g)),w&&(delete v.rel,delete v.href,v._cssText=Ge(w,g.href))}if(p==="style"&&e.sheet&&!(e.innerText||e.textContent||"").trim().length){const g=He(e.sheet);g&&(v._cssText=Ge(g,ht()))}if(p==="input"||p==="textarea"||p==="select"){const g=e.value,w=e.checked;v.type!=="radio"&&v.type!=="checkbox"&&v.type!=="submit"&&v.type!=="button"&&g?v.value=ut({element:e,type:dt(e),tagName:p,value:g,maskInputOptions:i,maskInputFn:s}):w&&(v.checked=w)}if(p==="option"&&(e.selected&&!i.select?v.selected=!0:delete v.selected),p==="canvas"&&u){if(e.__context==="2d")Sr(e)||(v.rr_dataURL=e.toDataURL(a.type,a.quality));else if(!("__context"in e)){const g=e.toDataURL(a.type,a.quality),w=document.createElement("canvas");w.width=e.width,w.height=e.height;const N=w.toDataURL(a.type,a.quality);g!==N&&(v.rr_dataURL=g)}}if(p==="img"&&c){Ce||(Ce=n.createElement("canvas"),Gt=Ce.getContext("2d"));const g=e,w=g.crossOrigin;g.crossOrigin="anonymous";const N=()=>{g.removeEventListener("load",N);try{Ce.width=g.naturalWidth,Ce.height=g.naturalHeight,Gt.drawImage(g,0,0),v.rr_dataURL=Ce.toDataURL(a.type,a.quality)}catch(x){console.warn(`Cannot inline img src=${g.currentSrc}! Error: ${x}`)}w?v.crossOrigin=w:g.removeAttribute("crossorigin")};g.complete&&g.naturalWidth!==0?N():g.addEventListener("load",N)}if((p==="audio"||p==="video")&&(v.rr_mediaState=e.paused?"paused":"played",v.rr_mediaCurrentTime=e.currentTime),h||(e.scrollLeft&&(v.rr_scrollLeft=e.scrollLeft),e.scrollTop&&(v.rr_scrollTop=e.scrollTop)),y){const{width:g,height:w}=e.getBoundingClientRect();v={class:v.class,rr_width:`${g}px`,rr_height:`${w}px`}}p==="iframe"&&!d(v.src)&&(e.contentDocument||(v.rr_src=v.src),delete v.src);let S;try{customElements.get(p)&&(S=!0)}catch{}return{type:T.Element,tagName:p,attributes:v,childNodes:[],isSVG:xr(e)||void 0,needBlock:y,rootId:m,isCustom:S}}function _(e){return e==null?"":e.toLowerCase()}function Wr(e,t){return!!(t.comment&&e.type===T.Comment||e.type===T.Element&&(t.script&&(e.tagName==="script"||e.tagName==="link"&&(e.attributes.rel==="preload"||e.attributes.rel==="modulepreload")&&e.attributes.as==="script"||e.tagName==="link"&&e.attributes.rel==="prefetch"&&typeof e.attributes.href=="string"&&e.attributes.href.endsWith(".js"))||t.headFavicon&&(e.tagName==="link"&&e.attributes.rel==="shortcut icon"||e.tagName==="meta"&&(_(e.attributes.name).match(/^msapplication-tile(image|color)$/)||_(e.attributes.name)==="application-name"||_(e.attributes.rel)==="icon"||_(e.attributes.rel)==="apple-touch-icon"||_(e.attributes.rel)==="shortcut icon"))||e.tagName==="meta"&&(t.headMetaDescKeywords&&_(e.attributes.name).match(/^description|keywords$/)||t.headMetaSocial&&(_(e.attributes.property).match(/^(og|twitter|fb):/)||_(e.attributes.name).match(/^(og|twitter):/)||_(e.attributes.name)==="pinterest")||t.headMetaRobots&&(_(e.attributes.name)==="robots"||_(e.attributes.name)==="googlebot"||_(e.attributes.name)==="bingbot")||t.headMetaHttpEquiv&&e.attributes["http-equiv"]!==void 0||t.headMetaAuthorship&&(_(e.attributes.name)==="author"||_(e.attributes.name)==="generator"||_(e.attributes.name)==="framework"||_(e.attributes.name)==="publisher"||_(e.attributes.name)==="progid"||_(e.attributes.property).match(/^article:/)||_(e.attributes.property).match(/^product:/))||t.headMetaVerification&&(_(e.attributes.name)==="google-site-verification"||_(e.attributes.name)==="yandex-verification"||_(e.attributes.name)==="csrf-token"||_(e.attributes.name)==="p:domain_verify"||_(e.attributes.name)==="verify-v1"||_(e.attributes.name)==="verification"||_(e.attributes.name)==="shopify-checkout-api-token"))))}function Me(e,t){const{doc:n,mirror:r,blockClass:o,blockSelector:l,maskTextClass:i,maskTextSelector:s,skipChild:a=!1,inlineStylesheet:c=!0,maskInputOptions:u={},maskTextFn:d,maskInputFn:h,slimDOMOptions:m,dataURLOptions:y={},inlineImages:p=!1,recordCanvas:v=!1,onSerialize:f,onIframeLoad:S,iframeLoadTimeout:g=5e3,onStylesheetLoad:w,stylesheetLoadTimeout:N=5e3,keepIframeSrcFn:x=()=>!1,newlyAddedElement:j=!1}=t;let{needsMask:V}=t,{preserveWhiteSpace:Q=!0}=t;!V&&e.childNodes&&(V=qt(e,i,s,V===void 0));const J=Fr(e,{doc:n,mirror:r,blockClass:o,blockSelector:l,needsMask:V,inlineStylesheet:c,maskInputOptions:u,maskTextFn:d,maskInputFn:h,dataURLOptions:y,inlineImages:p,recordCanvas:v,keepIframeSrcFn:x,newlyAddedElement:j});if(!J)return console.warn(e,"not serialized"),null;let ne;r.hasNode(e)?ne=r.getId(e):Wr(J,m)||!Q&&J.type===T.Text&&!J.isStyle&&!J.textContent.replace(/^\s+|\s+$/gm,"").length?ne=Pe:ne=Ht();const A=Object.assign(J,{id:ne});if(r.add(e,A),ne===Pe)return null;f&&f(e);let re=!a;if(A.type===T.Element){re=re&&!A.needBlock,delete A.needBlock;const H=e.shadowRoot;H&&Fe(H)&&(A.isShadowHost=!0)}if((A.type===T.Document||A.type===T.Element)&&re){m.headWhitespace&&A.type===T.Element&&A.tagName==="head"&&(Q=!1);const H={doc:n,mirror:r,blockClass:o,blockSelector:l,needsMask:V,maskTextClass:i,maskTextSelector:s,skipChild:a,inlineStylesheet:c,maskInputOptions:u,maskTextFn:d,maskInputFn:h,slimDOMOptions:m,dataURLOptions:y,inlineImages:p,recordCanvas:v,preserveWhiteSpace:Q,onSerialize:f,onIframeLoad:S,iframeLoadTimeout:g,onStylesheetLoad:w,stylesheetLoadTimeout:N,keepIframeSrcFn:x};if(!(A.type===T.Element&&A.tagName==="textarea"&&A.attributes.value!==void 0))for(const oe of Array.from(e.childNodes)){const G=Me(oe,H);G&&A.childNodes.push(G)}if(Bt(e)&&e.shadowRoot)for(const oe of Array.from(e.shadowRoot.childNodes)){const G=Me(oe,H);G&&(Fe(e.shadowRoot)&&(G.isShadow=!0),A.childNodes.push(G))}}return e.parentNode&&_e(e.parentNode)&&Fe(e.parentNode)&&(A.isShadow=!0),A.type===T.Element&&A.tagName==="iframe"&&Lr(e,()=>{const H=e.contentDocument;if(H&&S){const oe=Me(H,{doc:H,mirror:r,blockClass:o,blockSelector:l,needsMask:V,maskTextClass:i,maskTextSelector:s,skipChild:!1,inlineStylesheet:c,maskInputOptions:u,maskTextFn:d,maskInputFn:h,slimDOMOptions:m,dataURLOptions:y,inlineImages:p,recordCanvas:v,preserveWhiteSpace:Q,onSerialize:f,onIframeLoad:S,iframeLoadTimeout:g,onStylesheetLoad:w,stylesheetLoadTimeout:N,keepIframeSrcFn:x});oe&&S(e,oe)}},g),A.type===T.Element&&A.tagName==="link"&&A.attributes.rel==="stylesheet"&&_r(e,()=>{if(w){const H=Me(e,{doc:n,mirror:r,blockClass:o,blockSelector:l,needsMask:V,maskTextClass:i,maskTextSelector:s,skipChild:!1,inlineStylesheet:c,maskInputOptions:u,maskTextFn:d,maskInputFn:h,slimDOMOptions:m,dataURLOptions:y,inlineImages:p,recordCanvas:v,preserveWhiteSpace:Q,onSerialize:f,onIframeLoad:S,iframeLoadTimeout:g,onStylesheetLoad:w,stylesheetLoadTimeout:N,keepIframeSrcFn:x});H&&w(e,H)}},N),A}function Br(e,t){const{mirror:n=new ct,blockClass:r="rr-block",blockSelector:o=null,maskTextClass:l="rr-mask",maskTextSelector:i=null,inlineStylesheet:s=!0,inlineImages:a=!1,recordCanvas:c=!1,maskAllInputs:u=!1,maskTextFn:d,maskInputFn:h,slimDOM:m=!1,dataURLOptions:y,preserveWhiteSpace:p,onSerialize:v,onIframeLoad:f,iframeLoadTimeout:S,onStylesheetLoad:g,stylesheetLoadTimeout:w,keepIframeSrcFn:N=()=>!1}=t||{};return Me(e,{doc:e,mirror:n,blockClass:r,blockSelector:o,maskTextClass:l,maskTextSelector:i,skipChild:!1,inlineStylesheet:s,maskInputOptions:u===!0?{color:!0,date:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0,textarea:!0,select:!0,password:!0}:u===!1?{password:!0}:u,maskTextFn:d,maskInputFn:h,slimDOMOptions:m===!0||m==="all"?{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaDescKeywords:m==="all",headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaAuthorship:!0,headMetaVerification:!0}:m===!1?{}:m,dataURLOptions:y,inlineImages:a,recordCanvas:c,preserveWhiteSpace:p,onSerialize:v,onIframeLoad:f,iframeLoadTimeout:S,onStylesheetLoad:g,stylesheetLoadTimeout:w,keepIframeSrcFn:N,newlyAddedElement:!1})}const Qt=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g;function jr(e,t={}){let n=1,r=1;function o(C){const b=C.match(/\n/g);b&&(n+=b.length);const R=C.lastIndexOf(`
`);r=R===-1?r+C.length:C.length-R}function l(){const C={line:n,column:r};return b=>(b.position=new i(C),y(),b)}class i{constructor(b){this.start=b,this.end={line:n,column:r},this.source=t.source}}i.prototype.content=e;const s=[];function a(C){const b=new Error(`${t.source||""}:${n}:${r}: ${C}`);if(b.reason=C,b.filename=t.source,b.line=n,b.column=r,b.source=e,t.silent)s.push(b);else throw b}function c(){const C=h();return{type:"stylesheet",stylesheet:{source:t.source,rules:C,parsingErrors:s}}}function u(){return m(/^{\s*/)}function d(){return m(/^}/)}function h(){let C;const b=[];for(y(),p(b);e.length&&e.charAt(0)!=="}"&&(C=P()||he());)C&&(b.push(C),p(b));return b}function m(C){const b=C.exec(e);if(!b)return;const R=b[0];return o(R),e=e.slice(R.length),b}function y(){m(/^\s*/)}function p(C=[]){let b;for(;b=v();)b&&C.push(b),b=v();return C}function v(){const C=l();if(e.charAt(0)!=="/"||e.charAt(1)!=="*")return;let b=2;for(;e.charAt(b)!==""&&(e.charAt(b)!=="*"||e.charAt(b+1)!=="/");)++b;if(b+=2,e.charAt(b-1)==="")return a("End of comment missing");const R=e.slice(2,b-2);return r+=2,o(R),e=e.slice(b),r+=2,C({type:"comment",comment:R})}function f(){const C=m(/^([^{]+)/);if(C)return le(C[0]).replace(/\/\*([^*]|[\r\n]|(\*+([^*/]|[\r\n])))*\*\/+/g,"").replace(/"(?:\\"|[^"])*"|'(?:\\'|[^'])*'/g,b=>b.replace(/,/g,"\u200C")).split(/\s*(?![^(]*\)),\s*/).map(b=>b.replace(/\u200C/g,","))}function S(){const C=l(),b=m(/^(\*?[-#\/\*\\\w]+(\[[0-9a-z_-]+\])?)\s*/);if(!b)return;const R=le(b[0]);if(!m(/^:\s*/))return a("property missing ':'");const z=m(/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^\)]*?\)|[^};])+)/),ee=C({type:"declaration",property:R.replace(Qt,""),value:z?le(z[0]).replace(Qt,""):""});return m(/^[;\s]*/),ee}function g(){const C=[];if(!u())return a("missing '{'");p(C);let b;for(;b=S();)b!==!1&&(C.push(b),p(C)),b=S();return d()?C:a("missing '}'")}function w(){let C;const b=[],R=l();for(;C=m(/^((\d+\.\d+|\.\d+|\d+)%?|[a-z]+)\s*/);)b.push(C[1]),m(/^,\s*/);if(b.length)return R({type:"keyframe",values:b,declarations:g()})}function N(){const C=l();let b=m(/^@([-\w]+)?keyframes\s*/);if(!b)return;const R=b[1];if(b=m(/^([-\w]+)\s*/),!b)return a("@keyframes missing name");const z=b[1];if(!u())return a("@keyframes missing '{'");let ee,be=p();for(;ee=w();)be.push(ee),be=be.concat(p());return d()?C({type:"keyframes",name:z,vendor:R,keyframes:be}):a("@keyframes missing '}'")}function x(){const C=l(),b=m(/^@supports *([^{]+)/);if(!b)return;const R=le(b[1]);if(!u())return a("@supports missing '{'");const z=p().concat(h());return d()?C({type:"supports",supports:R,rules:z}):a("@supports missing '}'")}function j(){const C=l();if(!m(/^@host\s*/))return;if(!u())return a("@host missing '{'");const b=p().concat(h());return d()?C({type:"host",rules:b}):a("@host missing '}'")}function V(){const C=l(),b=m(/^@media *([^{]+)/);if(!b)return;const R=le(b[1]);if(!u())return a("@media missing '{'");const z=p().concat(h());return d()?C({type:"media",media:R,rules:z}):a("@media missing '}'")}function Q(){const C=l(),b=m(/^@custom-media\s+(--[^\s]+)\s*([^{;]+);/);if(b)return C({type:"custom-media",name:le(b[1]),media:le(b[2])})}function J(){const C=l();if(!m(/^@page */))return;const b=f()||[];if(!u())return a("@page missing '{'");let R=p(),z;for(;z=S();)R.push(z),R=R.concat(p());return d()?C({type:"page",selectors:b,declarations:R}):a("@page missing '}'")}function ne(){const C=l(),b=m(/^@([-\w]+)?document *([^{]+)/);if(!b)return;const R=le(b[1]),z=le(b[2]);if(!u())return a("@document missing '{'");const ee=p().concat(h());return d()?C({type:"document",document:z,vendor:R,rules:ee}):a("@document missing '}'")}function A(){const C=l();if(!m(/^@font-face\s*/))return;if(!u())return a("@font-face missing '{'");let b=p(),R;for(;R=S();)b.push(R),b=b.concat(p());return d()?C({type:"font-face",declarations:b}):a("@font-face missing '}'")}const re=G("import"),H=G("charset"),oe=G("namespace");function G(C){const b=new RegExp("^@"+C+"\\s*([^;]+);");return()=>{const R=l(),z=m(b);if(!z)return;const ee={type:C};return ee[C]=z[1].trim(),R(ee)}}function P(){if(e[0]==="@")return N()||V()||Q()||x()||re()||H()||oe()||ne()||J()||j()||A()}function he(){const C=l(),b=f();return b?(p(),C({type:"rule",selectors:b,declarations:g()})):a("selector missing")}return pt(c())}function le(e){return e?e.replace(/^\s+|\s+$/g,""):""}function pt(e,t){const n=e&&typeof e.type=="string",r=n?e:t;for(const o of Object.keys(e)){const l=e[o];Array.isArray(l)?l.forEach(i=>{pt(i,r)}):l&&typeof l=="object"&&pt(l,r)}return n&&Object.defineProperty(e,"parent",{configurable:!0,writable:!0,enumerable:!1,value:t||null}),e}const Jt={script:"noscript",altglyph:"altGlyph",altglyphdef:"altGlyphDef",altglyphitem:"altGlyphItem",animatecolor:"animateColor",animatemotion:"animateMotion",animatetransform:"animateTransform",clippath:"clipPath",feblend:"feBlend",fecolormatrix:"feColorMatrix",fecomponenttransfer:"feComponentTransfer",fecomposite:"feComposite",feconvolvematrix:"feConvolveMatrix",fediffuselighting:"feDiffuseLighting",fedisplacementmap:"feDisplacementMap",fedistantlight:"feDistantLight",fedropshadow:"feDropShadow",feflood:"feFlood",fefunca:"feFuncA",fefuncb:"feFuncB",fefuncg:"feFuncG",fefuncr:"feFuncR",fegaussianblur:"feGaussianBlur",feimage:"feImage",femerge:"feMerge",femergenode:"feMergeNode",femorphology:"feMorphology",feoffset:"feOffset",fepointlight:"fePointLight",fespecularlighting:"feSpecularLighting",fespotlight:"feSpotLight",fetile:"feTile",feturbulence:"feTurbulence",foreignobject:"foreignObject",glyphref:"glyphRef",lineargradient:"linearGradient",radialgradient:"radialGradient"};function Vr(e){let t=Jt[e.tagName]?Jt[e.tagName]:e.tagName;return t==="link"&&e.attributes._cssText&&(t="style"),t}function zr(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}const Kt=/([^\\]):hover/,Hr=new RegExp(Kt.source,"g");function Zt(e,t){const n=t?.stylesWithHoverClass.get(e);if(n)return n;const r=jr(e,{silent:!0});if(!r.stylesheet)return e;const o=[];if(r.stylesheet.rules.forEach(s=>{"selectors"in s&&(s.selectors||[]).forEach(a=>{Kt.test(a)&&o.push(a)})}),o.length===0)return e;const l=new RegExp(o.filter((s,a)=>o.indexOf(s)===a).sort((s,a)=>a.length-s.length).map(s=>zr(s)).join("|"),"g"),i=e.replace(l,s=>{const a=s.replace(Hr,"$1.\\:hover");return`${s}, ${a}`});return t?.stylesWithHoverClass.set(e,i),i}function en(){return{stylesWithHoverClass:new Map}}function Gr(e,t){var n;const{doc:r,hackCss:o,cache:l}=t;switch(e.type){case T.Document:return r.implementation.createDocument(null,"",null);case T.DocumentType:return r.implementation.createDocumentType(e.name||"html",e.publicId,e.systemId);case T.Element:{const i=Vr(e);let s;e.isSVG?s=r.createElementNS("http://www.w3.org/2000/svg",i):(e.isCustom&&((n=r.defaultView)===null||n===void 0?void 0:n.customElements)&&!r.defaultView.customElements.get(e.tagName)&&r.defaultView.customElements.define(e.tagName,class extends r.defaultView.HTMLElement{}),s=r.createElement(i));const a={};for(const c in e.attributes){if(!Object.prototype.hasOwnProperty.call(e.attributes,c))continue;let u=e.attributes[c];if(i==="option"&&c==="selected"&&u===!1||u===null)continue;if(u===!0&&(u=""),c.startsWith("rr_")){a[c]=u;continue}const d=i==="textarea"&&c==="value",h=i==="style"&&c==="_cssText";if(h&&o&&typeof u=="string"&&(u=Zt(u,l)),(d||h)&&typeof u=="string"){s.appendChild(r.createTextNode(u)),e.childNodes=[];continue}try{if(e.isSVG&&c==="xlink:href")s.setAttributeNS("http://www.w3.org/1999/xlink",c,u.toString());else if(c==="onload"||c==="onclick"||c.substring(0,7)==="onmouse")s.setAttribute("_"+c,u.toString());else if(i==="meta"&&e.attributes["http-equiv"]==="Content-Security-Policy"&&c==="content"){s.setAttribute("csp-content",u.toString());continue}else i==="link"&&(e.attributes.rel==="preload"||e.attributes.rel==="modulepreload")&&e.attributes.as==="script"||i==="link"&&e.attributes.rel==="prefetch"&&typeof e.attributes.href=="string"&&e.attributes.href.endsWith(".js")||(i==="img"&&e.attributes.srcset&&e.attributes.rr_dataURL?s.setAttribute("fpweb-original-srcset",e.attributes.srcset):s.setAttribute(c,u.toString()))}catch{}}for(const c in a){const u=a[c];if(i==="canvas"&&c==="rr_dataURL"){const d=document.createElement("img");d.onload=()=>{const h=s.getContext("2d");h&&h.drawImage(d,0,0,d.width,d.height)},d.src=u.toString(),s.RRNodeType&&(s.rr_dataURL=u.toString())}else if(i==="img"&&c==="rr_dataURL"){const d=s;d.currentSrc.startsWith("data:")||(d.setAttribute("fpweb-original-src",e.attributes.src),d.src=u.toString())}if(c==="rr_width")s.style.width=u.toString();else if(c==="rr_height")s.style.height=u.toString();else if(c==="rr_mediaCurrentTime"&&typeof u=="number")s.currentTime=u;else if(c==="rr_mediaState")switch(u){case"played":s.play().catch(d=>console.warn("media playback error",d));break;case"paused":s.pause();break}}if(e.isShadowHost)if(!s.shadowRoot)s.attachShadow({mode:"open"});else for(;s.shadowRoot.firstChild;)s.shadowRoot.removeChild(s.shadowRoot.firstChild);return s}case T.Text:return r.createTextNode(e.isStyle&&o?Zt(e.textContent,l):e.textContent);case T.CDATA:return r.createCDATASection(e.textContent);case T.Comment:return r.createComment(e.textContent);default:return null}}function $e(e,t){const{doc:n,mirror:r,skipChild:o=!1,hackCss:l=!0,afterAppend:i,cache:s}=t;if(r.has(e.id)){const c=r.getNode(e.id),u=r.getMeta(c);if(br(u,e))return r.getNode(e.id)}let a=Gr(e,{doc:n,hackCss:l,cache:s});if(!a)return null;if(e.rootId&&r.getNode(e.rootId)!==n&&r.replace(e.rootId,n),e.type===T.Document&&(n.close(),n.open(),e.compatMode==="BackCompat"&&e.childNodes&&e.childNodes[0].type!==T.DocumentType&&(e.childNodes[0].type===T.Element&&"xmlns"in e.childNodes[0].attributes&&e.childNodes[0].attributes.xmlns==="http://www.w3.org/1999/xhtml"?n.write('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "">'):n.write('<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "">')),a=n),r.add(a,e),(e.type===T.Document||e.type===T.Element)&&!o)for(const c of e.childNodes){const u=$e(c,{doc:n,mirror:r,skipChild:!1,hackCss:l,afterAppend:i,cache:s});if(!u){console.warn("Failed to rebuild",c);continue}if(c.isShadow&&Bt(a)&&a.shadowRoot)a.shadowRoot.appendChild(u);else if(e.type===T.Document&&c.type==T.Element){const d=u;let h=null;d.childNodes.forEach(m=>{m.nodeName==="BODY"&&(h=m)}),h?(d.removeChild(h),a.appendChild(u),d.appendChild(h)):a.appendChild(u)}else a.appendChild(u);i&&i(u,c.id)}return a}function Yr(e,t){function n(r){t(r)}for(const r of e.getIds())e.has(r)&&n(e.getNode(r))}function Xr(e,t){const n=t.getMeta(e);if(n?.type!==T.Element)return;const r=e;for(const o in n.attributes){if(!(Object.prototype.hasOwnProperty.call(n.attributes,o)&&o.startsWith("rr_")))continue;const l=n.attributes[o];o==="rr_scrollLeft"&&(r.scrollLeft=l),o==="rr_scrollTop"&&(r.scrollTop=l)}}function qr(e,t){const{doc:n,onVisit:r,hackCss:o=!0,afterAppend:l,cache:i,mirror:s=new ct}=t,a=$e(e,{doc:n,mirror:s,skipChild:!1,hackCss:o,afterAppend:l,cache:i});return Yr(s,c=>{r&&r(c),Xr(c,s)}),a}function Y(e,t,n=document){const r={capture:!0,passive:!0};return n.addEventListener(e,t,r),()=>n.removeEventListener(e,t,r)}const Te=`Please stop import mirror directly. Instead of that,\r
now you can use replayer.getMirror() to access the mirror instance of a replayer,\r
or you can use record.mirror to access the mirror instance during recording.`;q.mirror={map:{},getId(){return console.error(Te),-1},getNode(){return console.error(Te),null},removeNodeFromMap(){console.error(Te)},has(){return console.error(Te),!1},reset(){console.error(Te)}},typeof window<"u"&&window.Proxy&&window.Reflect&&(q.mirror=new Proxy(q.mirror,{get(e,t,n){return t==="map"&&console.error(Te),Reflect.get(e,t,n)}}));function Ne(e,t,n={}){let r=null,o=0;return function(...l){const i=Date.now();!o&&n.leading===!1&&(o=i);const s=t-(i-o),a=this;s<=0||s>t?(r&&(clearTimeout(r),r=null),o=i,e.apply(a,l)):!r&&n.trailing!==!1&&(r=setTimeout(()=>{o=n.leading===!1?0:Date.now(),r=null,e.apply(a,l)},s))}}function Ue(e,t,n,r,o=window){const l=o.Object.getOwnPropertyDescriptor(e,t);return o.Object.defineProperty(e,t,r?n:{set(i){setTimeout(()=>{n.set.call(this,i)},0),l&&l.set&&l.set.call(this,i)}}),()=>Ue(e,t,l||{},!0)}function ge(e,t,n){try{if(!(t in e))return()=>{};const r=e[t],o=n(r);return typeof o=="function"&&(o.prototype=o.prototype||{},Object.defineProperties(o,{__fpweb_original__:{enumerable:!1,value:r}})),e[t]=o,()=>{e[t]=r}}catch{return()=>{}}}let We=Date.now;/[1-9][0-9]{12}/.test(Date.now().toString())||(We=()=>new Date().getTime());function mt(e){var t,n,r,o,l,i;const s=e.document;return{left:s.scrollingElement?s.scrollingElement.scrollLeft:e.pageXOffset!==void 0?e.pageXOffset:s?.documentElement.scrollLeft||((n=(t=s?.body)==null?void 0:t.parentElement)==null?void 0:n.scrollLeft)||((r=s?.body)==null?void 0:r.scrollLeft)||0,top:s.scrollingElement?s.scrollingElement.scrollTop:e.pageYOffset!==void 0?e.pageYOffset:s?.documentElement.scrollTop||((l=(o=s?.body)==null?void 0:o.parentElement)==null?void 0:l.scrollTop)||((i=s?.body)==null?void 0:i.scrollTop)||0}}function ft(){return window.innerHeight||document.documentElement&&document.documentElement.clientHeight||document.body&&document.body.clientHeight}function yt(){return window.innerWidth||document.documentElement&&document.documentElement.clientWidth||document.body&&document.body.clientWidth}function gt(e){return e?e.nodeType===e.ELEMENT_NODE?e:e.parentElement:null}function X(e,t,n,r){if(!e)return!1;const o=gt(e);if(!o)return!1;try{if(typeof t=="string"){if(o.classList.contains(t)||r&&o.closest("."+t)!==null)return!0}else if(Xe(o,t,r))return!0}catch{}return!!(n&&(o.matches(n)||r&&o.closest(n)!==null))}function tn(e,t){return t.getId(e)!==-1}function qe(e,t){return t.getId(e)===Pe}function vt(e,t){if(_e(e))return!1;const n=t.getId(e);return t.has(n)?e.parentNode&&e.parentNode.nodeType===e.DOCUMENT_NODE?!1:e.parentNode?vt(e.parentNode,t):!0:!0}function Qe(e){return Boolean(e.changedTouches)}function St(e=window){"NodeList"in e&&!e.NodeList.prototype.forEach&&(e.NodeList.prototype.forEach=Array.prototype.forEach),"DOMTokenList"in e&&!e.DOMTokenList.prototype.forEach&&(e.DOMTokenList.prototype.forEach=Array.prototype.forEach),Node.prototype.contains||(Node.prototype.contains=(...t)=>{let n=t[0];if(!(0 in t))throw new TypeError("1 argument is required");do if(this===n)return!0;while(n=n&&n.parentNode);return!1})}function nn(e){const t={},n=(o,l)=>{const i={value:o,parent:l,children:[]};return t[o.node.id]=i,i},r=[];for(const o of e){const{nextId:l,parentId:i}=o;if(l&&l in t){const s=t[l];if(s.parent){const a=s.parent.children.indexOf(s);s.parent.children.splice(a,0,n(o,s.parent))}else{const a=r.indexOf(s);r.splice(a,0,n(o,null))}continue}if(i in t){const s=t[i];s.children.push(n(o,s));continue}r.push(n(o,null))}return r}function bt(e,t){t(e.value);for(let n=e.children.length-1;n>=0;n--)bt(e.children[n],t)}function Ie(e,t){return Boolean(e.nodeName==="IFRAME"&&t.getMeta(e))}function wt(e,t){return Boolean(e.nodeName==="LINK"&&e.nodeType===e.ELEMENT_NODE&&e.getAttribute&&e.getAttribute("rel")==="stylesheet"&&t.getMeta(e))}function Et(e,t){var n,r;const o=(r=(n=e.ownerDocument)==null?void 0:n.defaultView)==null?void 0:r.frameElement;if(!o||o===t)return{x:0,y:0,relativeScale:1,absoluteScale:1};const l=o.getBoundingClientRect(),i=Et(o,t),s=l.height/o.clientHeight;return{x:l.x*i.relativeScale+i.x,y:l.y*i.relativeScale+i.y,relativeScale:s,absoluteScale:i.absoluteScale*s}}function me(e){return Boolean(e?.shadowRoot)}function De(e,t){const n=e[t[0]];return t.length===1?n:De(n.cssRules[t[1]].cssRules,t.slice(2))}function Ct(e){const t=[...e],n=t.pop();return{positions:t,index:n}}function rn(e){const t=new Set,n=[];for(let r=e.length;r--;){const o=e[r];t.has(o.id)||(n.push(o),t.add(o.id))}return n}class Mt{constructor(){this.id=1,this.styleIDMap=new WeakMap,this.idStyleMap=new Map}getId(t){var n;return(n=this.styleIDMap.get(t))!=null?n:-1}has(t){return this.styleIDMap.has(t)}add(t,n){if(this.has(t))return this.getId(t);let r;return n===void 0?r=this.id++:r=n,this.styleIDMap.set(t,r),this.idStyleMap.set(r,t),r}getStyle(t){return this.idStyleMap.get(t)||null}reset(){this.styleIDMap=new WeakMap,this.idStyleMap=new Map,this.id=1}generateId(){return this.id++}}function Tt(e){var t,n;let r=null;return((n=(t=e.getRootNode)==null?void 0:t.call(e))==null?void 0:n.nodeType)===Node.DOCUMENT_FRAGMENT_NODE&&e.getRootNode().host&&(r=e.getRootNode().host),r}function on(e){let t=e,n;for(;n=Tt(t);)t=n;return t}function sn(e){const t=e.ownerDocument;if(!t)return!1;const n=on(e);return t.contains(n)}function Nt(e){const t=e.ownerDocument;return t?t.contains(e)||sn(e):!1}var Qr=Object.freeze({__proto__:null,on:Y,get _mirror(){return q.mirror},throttle:Ne,hookSetter:Ue,patch:ge,get nowTimestamp(){return We},getWindowScroll:mt,getWindowHeight:ft,getWindowWidth:yt,closestElementOfNode:gt,isBlocked:X,isSerialized:tn,isIgnored:qe,isAncestorRemoved:vt,legacy_isTouchEvent:Qe,polyfill:St,queueToResolveTrees:nn,iterateResolveTree:bt,isSerializedIframe:Ie,isSerializedStylesheet:wt,getBaseDimension:Et,hasShadowRoot:me,getNestedRule:De,getPositionsAndIndex:Ct,uniqueTextMutations:rn,StyleSheetMirror:Mt,getShadowHost:Tt,getRootShadowHost:on,shadowHostInDom:sn,inDom:Nt}),M=(e=>(e[e.DomContentLoaded=0]="DomContentLoaded",e[e.Load=1]="Load",e[e.FullSnapshot=2]="FullSnapshot",e[e.IncrementalSnapshot=3]="IncrementalSnapshot",e[e.Meta=4]="Meta",e[e.Custom=5]="Custom",e[e.Plugin=6]="Plugin",e))(M||{}),E=(e=>(e[e.Mutation=0]="Mutation",e[e.MouseMove=1]="MouseMove",e[e.MouseInteraction=2]="MouseInteraction",e[e.Scroll=3]="Scroll",e[e.ViewportResize=4]="ViewportResize",e[e.Input=5]="Input",e[e.TouchMove=6]="TouchMove",e[e.MediaInteraction=7]="MediaInteraction",e[e.StyleSheetRule=8]="StyleSheetRule",e[e.CanvasMutation=9]="CanvasMutation",e[e.Font=10]="Font",e[e.Log=11]="Log",e[e.Drag=12]="Drag",e[e.StyleDeclaration=13]="StyleDeclaration",e[e.Selection=14]="Selection",e[e.AdoptedStyleSheet=15]="AdoptedStyleSheet",e[e.CustomElement=16]="CustomElement",e))(E||{}),O=(e=>(e[e.MouseUp=0]="MouseUp",e[e.MouseDown=1]="MouseDown",e[e.Click=2]="Click",e[e.ContextMenu=3]="ContextMenu",e[e.DblClick=4]="DblClick",e[e.Focus=5]="Focus",e[e.Blur=6]="Blur",e[e.TouchStart=7]="TouchStart",e[e.TouchMove_Departed=8]="TouchMove_Departed",e[e.TouchEnd=9]="TouchEnd",e[e.TouchCancel=10]="TouchCancel",e))(O||{}),ce=(e=>(e[e.Mouse=0]="Mouse",e[e.Pen=1]="Pen",e[e.Touch=2]="Touch",e))(ce||{}),ue=(e=>(e[e["2D"]=0]="2D",e[e.WebGL=1]="WebGL",e[e.WebGL2=2]="WebGL2",e))(ue||{}),de=(e=>(e[e.Play=0]="Play",e[e.Pause=1]="Pause",e[e.Seeked=2]="Seeked",e[e.VolumeChange=3]="VolumeChange",e[e.RateChange=4]="RateChange",e))(de||{}),L=(e=>(e.Start="start",e.Pause="pause",e.Resume="resume",e.Resize="resize",e.Finish="finish",e.FullsnapshotRebuilded="fullsnapshot-rebuilded",e.LoadStylesheetStart="load-stylesheet-start",e.LoadStylesheetEnd="load-stylesheet-end",e.SkipStart="skip-start",e.SkipEnd="skip-end",e.MouseInteraction="mouse-interaction",e.EventCast="event-cast",e.CustomEvent="custom-event",e.Flush="flush",e.StateChange="state-change",e.PlayBack="play-back",e.Destroy="destroy",e))(L||{});function an(e){return"__ln"in e}class Jr{constructor(){this.length=0,this.head=null,this.tail=null}get(t){if(t>=this.length)throw new Error("Position outside of list range");let n=this.head;for(let r=0;r<t;r++)n=n?.next||null;return n}addNode(t){const n={value:t,previous:null,next:null};if(t.__ln=n,t.previousSibling&&an(t.previousSibling)){const r=t.previousSibling.__ln.next;n.next=r,n.previous=t.previousSibling.__ln,t.previousSibling.__ln.next=n,r&&(r.previous=n)}else if(t.nextSibling&&an(t.nextSibling)&&t.nextSibling.__ln.previous){const r=t.nextSibling.__ln.previous;n.previous=r,n.next=t.nextSibling.__ln,t.nextSibling.__ln.previous=n,r&&(r.next=n)}else this.head&&(this.head.previous=n),n.next=this.head,this.head=n;n.next===null&&(this.tail=n),this.length++}removeNode(t){const n=t.__ln;!this.head||(n.previous?(n.previous.next=n.next,n.next?n.next.previous=n.previous:this.tail=n.previous):(this.head=n.next,this.head?this.head.previous=null:this.tail=null),t.__ln&&delete t.__ln,this.length--)}}const ln=(e,t)=>`${e}@${t}`;class Kr{constructor(){this.frozen=!1,this.locked=!1,this.texts=[],this.attributes=[],this.attributeMap=new WeakMap,this.removes=[],this.mapRemoves=[],this.movedMap={},this.addedSet=new Set,this.movedSet=new Set,this.droppedSet=new Set,this.processMutations=t=>{t.forEach(this.processMutation),this.emit()},this.emit=()=>{if(this.frozen||this.locked)return;const t=[],n=new Set,r=new Jr,o=a=>{let c=a,u=Pe;for(;u===Pe;)c=c&&c.nextSibling,u=c&&this.mirror.getId(c);return u},l=a=>{if(!a.parentNode||!Nt(a)||a.parentNode.tagName==="TEXTAREA")return;const c=_e(a.parentNode)?this.mirror.getId(Tt(a)):this.mirror.getId(a.parentNode),u=o(a);if(c===-1||u===-1)return r.addNode(a);const d=Me(a,{doc:this.doc,mirror:this.mirror,blockClass:this.blockClass,blockSelector:this.blockSelector,maskTextClass:this.maskTextClass,maskTextSelector:this.maskTextSelector,skipChild:!0,newlyAddedElement:!0,inlineStylesheet:this.inlineStylesheet,maskInputOptions:this.maskInputOptions,maskTextFn:this.maskTextFn,maskInputFn:this.maskInputFn,slimDOMOptions:this.slimDOMOptions,dataURLOptions:this.dataURLOptions,recordCanvas:this.recordCanvas,inlineImages:this.inlineImages,onSerialize:h=>{Ie(h,this.mirror)&&this.iframeManager.addIframe(h),wt(h,this.mirror)&&this.stylesheetManager.trackLinkElement(h),me(a)&&this.shadowDomManager.addShadowRoot(a.shadowRoot,this.doc)},onIframeLoad:(h,m)=>{this.iframeManager.attachIframe(h,m),this.shadowDomManager.observeAttachShadow(h)},onStylesheetLoad:(h,m)=>{this.stylesheetManager.attachLinkElement(h,m)}});d&&(t.push({parentId:c,nextId:u,node:d}),n.add(d.id))};for(;this.mapRemoves.length;)this.mirror.removeNodeFromMap(this.mapRemoves.shift());for(const a of this.movedSet)cn(this.removes,a,this.mirror)&&!this.movedSet.has(a.parentNode)||l(a);for(const a of this.addedSet)!dn(this.droppedSet,a)&&!cn(this.removes,a,this.mirror)||dn(this.movedSet,a)?l(a):this.droppedSet.add(a);let i=null;for(;r.length;){let a=null;if(i){const c=this.mirror.getId(i.value.parentNode),u=o(i.value);c!==-1&&u!==-1&&(a=i)}if(!a){let c=r.tail;for(;c;){const u=c;if(c=c.previous,u){const d=this.mirror.getId(u.value.parentNode);if(o(u.value)===-1)continue;if(d!==-1){a=u;break}else{const h=u.value;if(h.parentNode&&h.parentNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE){const m=h.parentNode.host;if(this.mirror.getId(m)!==-1){a=u;break}}}}}}if(!a){for(;r.head;)r.removeNode(r.head.value);break}i=a.previous,r.removeNode(a.value),l(a.value)}const s={texts:this.texts.map(a=>{const c=a.node;return c.parentNode.tagName==="TEXTAREA"&&this.genTextAreaValueMutation(c.parentNode),{id:this.mirror.getId(c),value:a.value}}).filter(a=>!n.has(a.id)).filter(a=>this.mirror.has(a.id)),attributes:this.attributes.map(a=>{const{attributes:c}=a;if(typeof c.style=="string"){const u=JSON.stringify(a.styleDiff),d=JSON.stringify(a._unchangedStyles);u.length<c.style.length&&(u+d).split("var(").length===c.style.split("var(").length&&(c.style=a.styleDiff)}return{id:this.mirror.getId(a.node),attributes:c}}).filter(a=>!n.has(a.id)).filter(a=>this.mirror.has(a.id)),removes:this.removes,adds:t};!s.texts.length&&!s.attributes.length&&!s.removes.length&&!s.adds.length||(this.texts=[],this.attributes=[],this.attributeMap=new WeakMap,this.removes=[],this.addedSet=new Set,this.movedSet=new Set,this.droppedSet=new Set,this.movedMap={},this.mutationCb(s))},this.genTextAreaValueMutation=t=>{let n=this.attributeMap.get(t);n||(n={node:t,attributes:{},styleDiff:{},_unchangedStyles:{}},this.attributes.push(n),this.attributeMap.set(t,n)),n.attributes.value=Array.from(t.childNodes,r=>r.textContent||"").join("")},this.processMutation=t=>{if(!qe(t.target,this.mirror))switch(t.type){case"characterData":{const n=t.target.textContent;!X(t.target,this.blockClass,this.blockSelector,!1)&&n!==t.oldValue&&this.texts.push({value:qt(t.target,this.maskTextClass,this.maskTextSelector,!0)&&n?this.maskTextFn?this.maskTextFn(n,gt(t.target)):n.replace(/[\S]/g,"*"):n,node:t.target});break}case"attributes":{const n=t.target;let r=t.attributeName,o=t.target.getAttribute(r);if(r==="value"){const i=dt(n);o=ut({element:n,maskInputOptions:this.maskInputOptions,tagName:n.tagName,type:i,value:o,maskInputFn:this.maskInputFn})}if(X(t.target,this.blockClass,this.blockSelector,!1)||o===t.oldValue)return;let l=this.attributeMap.get(t.target);if(n.tagName==="IFRAME"&&r==="src"&&!this.keepIframeSrcFn(o))if(!n.contentDocument)r="rr_src";else return;if(l||(l={node:t.target,attributes:{},styleDiff:{},_unchangedStyles:{}},this.attributes.push(l),this.attributeMap.set(t.target,l)),r==="type"&&n.tagName==="INPUT"&&(t.oldValue||"").toLowerCase()==="password"&&n.setAttribute("data-rr-is-password","true"),!Xt(n.tagName,r)&&(l.attributes[r]=Yt(this.doc,pe(n.tagName),pe(r),o),r==="style")){if(!this.unattachedDoc)try{this.unattachedDoc=document.implementation.createHTMLDocument()}catch{this.unattachedDoc=this.doc}const i=this.unattachedDoc.createElement("span");t.oldValue&&i.setAttribute("style",t.oldValue);for(const s of Array.from(n.style)){const a=n.style.getPropertyValue(s),c=n.style.getPropertyPriority(s);a!==i.style.getPropertyValue(s)||c!==i.style.getPropertyPriority(s)?c===""?l.styleDiff[s]=a:l.styleDiff[s]=[a,c]:l._unchangedStyles[s]=[a,c]}for(const s of Array.from(i.style))n.style.getPropertyValue(s)===""&&(l.styleDiff[s]=!1)}break}case"childList":{if(X(t.target,this.blockClass,this.blockSelector,!0))return;if(t.target.tagName==="TEXTAREA"){this.genTextAreaValueMutation(t.target);return}t.addedNodes.forEach(n=>this.genAdds(n,t.target)),t.removedNodes.forEach(n=>{const r=this.mirror.getId(n),o=_e(t.target)?this.mirror.getId(t.target.host):this.mirror.getId(t.target);X(t.target,this.blockClass,this.blockSelector,!1)||qe(n,this.mirror)||!tn(n,this.mirror)||(this.addedSet.has(n)?(It(this.addedSet,n),this.droppedSet.add(n)):this.addedSet.has(t.target)&&r===-1||vt(t.target,this.mirror)||(this.movedSet.has(n)&&this.movedMap[ln(r,o)]?It(this.movedSet,n):this.removes.push({parentId:o,id:r,isShadow:_e(t.target)&&Fe(t.target)?!0:void 0})),this.mapRemoves.push(n))});break}}},this.genAdds=(t,n)=>{if(!this.processedNodeManager.inOtherBuffer(t,this)&&!(this.addedSet.has(t)||this.movedSet.has(t))){if(this.mirror.hasNode(t)){if(qe(t,this.mirror))return;this.movedSet.add(t);let r=null;n&&this.mirror.hasNode(n)&&(r=this.mirror.getId(n)),r&&r!==-1&&(this.movedMap[ln(this.mirror.getId(t),r)]=!0)}else this.addedSet.add(t),this.droppedSet.delete(t);X(t,this.blockClass,this.blockSelector,!1)||(t.childNodes.forEach(r=>this.genAdds(r)),me(t)&&t.shadowRoot.childNodes.forEach(r=>{this.processedNodeManager.add(r,this),this.genAdds(r,t)}))}}}init(t){["mutationCb","blockClass","blockSelector","maskTextClass","maskTextSelector","inlineStylesheet","maskInputOptions","maskTextFn","maskInputFn","keepIframeSrcFn","recordCanvas","inlineImages","slimDOMOptions","dataURLOptions","doc","mirror","iframeManager","stylesheetManager","shadowDomManager","canvasManager","processedNodeManager"].forEach(n=>{this[n]=t[n]})}freeze(){this.frozen=!0,this.canvasManager.freeze()}unfreeze(){this.frozen=!1,this.canvasManager.unfreeze(),this.emit()}isFrozen(){return this.frozen}lock(){this.locked=!0,this.canvasManager.lock()}unlock(){this.locked=!1,this.canvasManager.unlock(),this.emit()}reset(){this.shadowDomManager.reset(),this.canvasManager.reset()}}function It(e,t){e.delete(t),t.childNodes.forEach(n=>It(e,n))}function cn(e,t,n){return e.length===0?!1:un(e,t,n)}function un(e,t,n){const{parentNode:r}=t;if(!r)return!1;const o=n.getId(r);return e.some(l=>l.id===o)?!0:un(e,r,n)}function dn(e,t){return e.size===0?!1:hn(e,t)}function hn(e,t){const{parentNode:n}=t;return n?e.has(n)?!0:hn(e,n):!1}let Be;function Zr(e){Be=e}function eo(){Be=void 0}const k=e=>Be?(...t)=>{try{return e(...t)}catch(n){if(Be&&Be(n)===!0)return;throw n}}:e;var to=Object.defineProperty,no=Object.defineProperties,ro=Object.getOwnPropertyDescriptors,pn=Object.getOwnPropertySymbols,oo=Object.prototype.hasOwnProperty,so=Object.prototype.propertyIsEnumerable,mn=(e,t,n)=>t in e?to(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,fn=(e,t)=>{for(var n in t||(t={}))oo.call(t,n)&&mn(e,n,t[n]);if(pn)for(var n of pn(t))so.call(t,n)&&mn(e,n,t[n]);return e},io=(e,t)=>no(e,ro(t));const ve=[];function je(e){try{if("composedPath"in e){const t=e.composedPath();if(t.length)return t[0]}else if("path"in e&&e.path.length)return e.path[0]}catch{}return e&&e.target}function yn(e,t){var n,r;const o=new Kr;ve.push(o),o.init(e);let l=window.MutationObserver||window.__rrMutationObserver;const i=(r=(n=window?.Zone)==null?void 0:n.__symbol__)==null?void 0:r.call(n,"MutationObserver");i&&window[i]&&(l=window[i]);const s=new l(k(o.processMutations.bind(o)));return s.observe(t,{attributes:!0,attributeOldValue:!0,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0}),s}function ao({mousemoveCb:e,sampling:t,doc:n,mirror:r}){if(t.mousemove===!1)return()=>{};const o=typeof t.mousemove=="number"?t.mousemove:50,l=typeof t.mousemoveCallback=="number"?t.mousemoveCallback:500;let i=[],s;const a=Ne(k(d=>{const h=Date.now()-s;e(i.map(m=>(m.timeOffset-=h,m)),d),i=[],s=null}),l),c=k(Ne(k(d=>{const h=je(d),{clientX:m,clientY:y}=Qe(d)?d.changedTouches[0]:d;s||(s=We()),i.push({x:m,y,id:r.getId(h),timeOffset:We()-s}),a(typeof DragEvent<"u"&&d instanceof DragEvent?E.Drag:d instanceof MouseEvent?E.MouseMove:E.TouchMove)}),o,{trailing:!1})),u=[Y("mousemove",c,n),Y("touchmove",c,n),Y("drag",c,n)];return k(()=>{u.forEach(d=>d())})}function lo({mouseInteractionCb:e,doc:t,mirror:n,blockClass:r,blockSelector:o,sampling:l}){if(l.mouseInteraction===!1)return()=>{};const i=l.mouseInteraction===!0||l.mouseInteraction===void 0?{}:l.mouseInteraction,s=[];let a=null;const c=u=>d=>{const h=je(d);if(X(h,r,o,!0))return;let m=null,y=u;if("pointerType"in d){switch(d.pointerType){case"mouse":m=ce.Mouse;break;case"touch":m=ce.Touch;break;case"pen":m=ce.Pen;break}m===ce.Touch?O[u]===O.MouseDown?y="TouchStart":O[u]===O.MouseUp&&(y="TouchEnd"):ce.Pen}else Qe(d)&&(m=ce.Touch);m!==null?(a=m,(y.startsWith("Touch")&&m===ce.Touch||y.startsWith("Mouse")&&m===ce.Mouse)&&(m=null)):O[u]===O.Click&&(m=a,a=null);const p=Qe(d)?d.changedTouches[0]:d;if(!p)return;const v=n.getId(h),{clientX:f,clientY:S}=p;k(e)(fn({type:O[y],id:v,x:f,y:S},m!==null&&{pointerType:m}))};return Object.keys(O).filter(u=>Number.isNaN(Number(u))&&!u.endsWith("_Departed")&&i[u]!==!1).forEach(u=>{let d=pe(u);const h=c(u);if(window.PointerEvent)switch(O[u]){case O.MouseDown:case O.MouseUp:d=d.replace("mouse","pointer");break;case O.TouchStart:case O.TouchEnd:return}s.push(Y(d,h,t))}),k(()=>{s.forEach(u=>u())})}function gn({scrollCb:e,doc:t,mirror:n,blockClass:r,blockSelector:o,sampling:l}){const i=k(Ne(k(s=>{const a=je(s);if(!a||X(a,r,o,!0))return;const c=n.getId(a);if(a===t&&t.defaultView){const u=mt(t.defaultView);e({id:c,x:u.left,y:u.top})}else e({id:c,x:a.scrollLeft,y:a.scrollTop})}),l.scroll||100));return Y("scroll",i,t)}function co({viewportResizeCb:e},{win:t}){let n=-1,r=-1;const o=k(Ne(k(()=>{const l=ft(),i=yt();(n!==l||r!==i)&&(e({width:Number(i),height:Number(l)}),n=l,r=i)}),200));return Y("resize",o,t)}const uo=["INPUT","TEXTAREA","SELECT"],vn=new WeakMap;function ho({inputCb:e,doc:t,mirror:n,blockClass:r,blockSelector:o,ignoreClass:l,ignoreSelector:i,maskInputOptions:s,maskInputFn:a,sampling:c,userTriggeredOnInput:u}){function d(f){let S=je(f);const g=f.isTrusted,w=S&&S.tagName;if(S&&w==="OPTION"&&(S=S.parentElement),!S||!w||uo.indexOf(w)<0||X(S,r,o,!0)||S.classList.contains(l)||i&&S.matches(i))return;let N=S.value,x=!1;const j=dt(S)||"";j==="radio"||j==="checkbox"?x=S.checked:(s[w.toLowerCase()]||s[j])&&(N=ut({element:S,maskInputOptions:s,tagName:w,type:j,value:N,maskInputFn:a})),h(S,u?{text:N,isChecked:x,userTriggered:g}:{text:N,isChecked:x});const V=S.name;j==="radio"&&V&&x&&t.querySelectorAll(`input[type="radio"][name="${V}"]`).forEach(Q=>{if(Q!==S){const J=Q.value;h(Q,u?{text:J,isChecked:!x,userTriggered:!1}:{text:J,isChecked:!x})}})}function h(f,S){const g=vn.get(f);if(!g||g.text!==S.text||g.isChecked!==S.isChecked){vn.set(f,S);const w=n.getId(f);k(e)(io(fn({},S),{id:w}))}}const m=(c.input==="last"?["change"]:["input","change"]).map(f=>Y(f,k(d),t)),y=t.defaultView;if(!y)return()=>{m.forEach(f=>f())};const p=y.Object.getOwnPropertyDescriptor(y.HTMLInputElement.prototype,"value"),v=[[y.HTMLInputElement.prototype,"value"],[y.HTMLInputElement.prototype,"checked"],[y.HTMLSelectElement.prototype,"value"],[y.HTMLTextAreaElement.prototype,"value"],[y.HTMLSelectElement.prototype,"selectedIndex"],[y.HTMLOptionElement.prototype,"selected"]];return p&&p.set&&m.push(...v.map(f=>Ue(f[0],f[1],{set(){k(d)({target:this,isTrusted:!1})}},!1,y))),k(()=>{m.forEach(f=>f())})}function Je(e){const t=[];function n(r,o){if(Ke("CSSGroupingRule")&&r.parentRule instanceof CSSGroupingRule||Ke("CSSMediaRule")&&r.parentRule instanceof CSSMediaRule||Ke("CSSSupportsRule")&&r.parentRule instanceof CSSSupportsRule||Ke("CSSConditionRule")&&r.parentRule instanceof CSSConditionRule){const l=Array.from(r.parentRule.cssRules).indexOf(r);o.unshift(l)}else if(r.parentStyleSheet){const l=Array.from(r.parentStyleSheet.cssRules).indexOf(r);o.unshift(l)}return o}return n(e,t)}function fe(e,t,n){let r,o;return e?(e.ownerNode?r=t.getId(e.ownerNode):o=n.getId(e),{styleId:o,id:r}):{}}function po({styleSheetRuleCb:e,mirror:t,stylesheetManager:n},{win:r}){if(!r.CSSStyleSheet||!r.CSSStyleSheet.prototype)return()=>{};const o=r.CSSStyleSheet.prototype.insertRule;r.CSSStyleSheet.prototype.insertRule=new Proxy(o,{apply:k((u,d,h)=>{const[m,y]=h,{id:p,styleId:v}=fe(d,t,n.styleMirror);return(p&&p!==-1||v&&v!==-1)&&e({id:p,styleId:v,adds:[{rule:m,index:y}]}),u.apply(d,h)})});const l=r.CSSStyleSheet.prototype.deleteRule;r.CSSStyleSheet.prototype.deleteRule=new Proxy(l,{apply:k((u,d,h)=>{const[m]=h,{id:y,styleId:p}=fe(d,t,n.styleMirror);return(y&&y!==-1||p&&p!==-1)&&e({id:y,styleId:p,removes:[{index:m}]}),u.apply(d,h)})});let i;r.CSSStyleSheet.prototype.replace&&(i=r.CSSStyleSheet.prototype.replace,r.CSSStyleSheet.prototype.replace=new Proxy(i,{apply:k((u,d,h)=>{const[m]=h,{id:y,styleId:p}=fe(d,t,n.styleMirror);return(y&&y!==-1||p&&p!==-1)&&e({id:y,styleId:p,replace:m}),u.apply(d,h)})}));let s;r.CSSStyleSheet.prototype.replaceSync&&(s=r.CSSStyleSheet.prototype.replaceSync,r.CSSStyleSheet.prototype.replaceSync=new Proxy(s,{apply:k((u,d,h)=>{const[m]=h,{id:y,styleId:p}=fe(d,t,n.styleMirror);return(y&&y!==-1||p&&p!==-1)&&e({id:y,styleId:p,replaceSync:m}),u.apply(d,h)})}));const a={};Ze("CSSGroupingRule")?a.CSSGroupingRule=r.CSSGroupingRule:(Ze("CSSMediaRule")&&(a.CSSMediaRule=r.CSSMediaRule),Ze("CSSConditionRule")&&(a.CSSConditionRule=r.CSSConditionRule),Ze("CSSSupportsRule")&&(a.CSSSupportsRule=r.CSSSupportsRule));const c={};return Object.entries(a).forEach(([u,d])=>{c[u]={insertRule:d.prototype.insertRule,deleteRule:d.prototype.deleteRule},d.prototype.insertRule=new Proxy(c[u].insertRule,{apply:k((h,m,y)=>{const[p,v]=y,{id:f,styleId:S}=fe(m.parentStyleSheet,t,n.styleMirror);return(f&&f!==-1||S&&S!==-1)&&e({id:f,styleId:S,adds:[{rule:p,index:[...Je(m),v||0]}]}),h.apply(m,y)})}),d.prototype.deleteRule=new Proxy(c[u].deleteRule,{apply:k((h,m,y)=>{const[p]=y,{id:v,styleId:f}=fe(m.parentStyleSheet,t,n.styleMirror);return(v&&v!==-1||f&&f!==-1)&&e({id:v,styleId:f,removes:[{index:[...Je(m),p]}]}),h.apply(m,y)})})}),k(()=>{r.CSSStyleSheet.prototype.insertRule=o,r.CSSStyleSheet.prototype.deleteRule=l,i&&(r.CSSStyleSheet.prototype.replace=i),s&&(r.CSSStyleSheet.prototype.replaceSync=s),Object.entries(a).forEach(([u,d])=>{d.prototype.insertRule=c[u].insertRule,d.prototype.deleteRule=c[u].deleteRule})})}function Sn({mirror:e,stylesheetManager:t},n){var r,o,l;let i=null;n.nodeName==="#document"?i=e.getId(n):i=e.getId(n.host);const s=n.nodeName==="#document"?(r=n.defaultView)==null?void 0:r.Document:(l=(o=n.ownerDocument)==null?void 0:o.defaultView)==null?void 0:l.ShadowRoot,a=s!=null&&s.prototype?Object.getOwnPropertyDescriptor(s?.prototype,"adoptedStyleSheets"):void 0;return i===null||i===-1||!s||!a?()=>{}:(Object.defineProperty(n,"adoptedStyleSheets",{configurable:a.configurable,enumerable:a.enumerable,get(){var c;return(c=a.get)==null?void 0:c.call(this)},set(c){var u;const d=(u=a.set)==null?void 0:u.call(this,c);if(i!==null&&i!==-1)try{t.adoptStyleSheets(c,i)}catch{}return d}}),k(()=>{Object.defineProperty(n,"adoptedStyleSheets",{configurable:a.configurable,enumerable:a.enumerable,get:a.get,set:a.set})}))}function mo({styleDeclarationCb:e,mirror:t,ignoreCSSAttributes:n,stylesheetManager:r},{win:o}){const l=o.CSSStyleDeclaration.prototype.setProperty;o.CSSStyleDeclaration.prototype.setProperty=new Proxy(l,{apply:k((s,a,c)=>{var u;const[d,h,m]=c;if(n.has(d))return l.apply(a,[d,h,m]);const{id:y,styleId:p}=fe((u=a.parentRule)==null?void 0:u.parentStyleSheet,t,r.styleMirror);return(y&&y!==-1||p&&p!==-1)&&e({id:y,styleId:p,set:{property:d,value:h,priority:m},index:Je(a.parentRule)}),s.apply(a,c)})});const i=o.CSSStyleDeclaration.prototype.removeProperty;return o.CSSStyleDeclaration.prototype.removeProperty=new Proxy(i,{apply:k((s,a,c)=>{var u;const[d]=c;if(n.has(d))return i.apply(a,[d]);const{id:h,styleId:m}=fe((u=a.parentRule)==null?void 0:u.parentStyleSheet,t,r.styleMirror);return(h&&h!==-1||m&&m!==-1)&&e({id:h,styleId:m,remove:{property:d},index:Je(a.parentRule)}),s.apply(a,c)})}),k(()=>{o.CSSStyleDeclaration.prototype.setProperty=l,o.CSSStyleDeclaration.prototype.removeProperty=i})}function fo({mediaInteractionCb:e,blockClass:t,blockSelector:n,mirror:r,sampling:o,doc:l}){const i=k(a=>Ne(k(c=>{const u=je(c);if(!u||X(u,t,n,!0))return;const{currentTime:d,volume:h,muted:m,playbackRate:y}=u;e({type:a,id:r.getId(u),currentTime:d,volume:h,muted:m,playbackRate:y})}),o.media||500)),s=[Y("play",i(de.Play),l),Y("pause",i(de.Pause),l),Y("seeked",i(de.Seeked),l),Y("volumechange",i(de.VolumeChange),l),Y("ratechange",i(de.RateChange),l)];return k(()=>{s.forEach(a=>a())})}function yo({fontCb:e,doc:t}){const n=t.defaultView;if(!n)return()=>{};const r=[],o=new WeakMap,l=n.FontFace;n.FontFace=function(s,a,c){const u=new l(s,a,c);return o.set(u,{family:s,buffer:typeof a!="string",descriptors:c,fontSource:typeof a=="string"?a:JSON.stringify(Array.from(new Uint8Array(a)))}),u};const i=ge(t.fonts,"add",function(s){return function(a){return setTimeout(k(()=>{const c=o.get(a);c&&(e(c),o.delete(a))}),0),s.apply(this,[a])}});return r.push(()=>{n.FontFace=l}),r.push(i),k(()=>{r.forEach(s=>s())})}function go(e){const{doc:t,mirror:n,blockClass:r,blockSelector:o,selectionCb:l}=e;let i=!0;const s=k(()=>{const a=t.getSelection();if(!a||i&&a?.isCollapsed)return;i=a.isCollapsed||!1;const c=[],u=a.rangeCount||0;for(let d=0;d<u;d++){const h=a.getRangeAt(d),{startContainer:m,startOffset:y,endContainer:p,endOffset:v}=h;X(m,r,o,!0)||X(p,r,o,!0)||c.push({start:n.getId(m),startOffset:y,end:n.getId(p),endOffset:v})}l({ranges:c})});return s(),Y("selectionchange",s)}function vo({doc:e,customElementCb:t}){const n=e.defaultView;return!n||!n.customElements?()=>{}:ge(n.customElements,"define",function(r){return function(o,l,i){try{t({define:{name:o}})}catch{console.warn(`Custom element callback failed for ${o}`)}return r.apply(this,[o,l,i])}})}function So(e,t){const{mutationCb:n,mousemoveCb:r,mouseInteractionCb:o,scrollCb:l,viewportResizeCb:i,inputCb:s,mediaInteractionCb:a,styleSheetRuleCb:c,styleDeclarationCb:u,canvasMutationCb:d,fontCb:h,selectionCb:m,customElementCb:y}=e;e.mutationCb=(...p)=>{t.mutation&&t.mutation(...p),n(...p)},e.mousemoveCb=(...p)=>{t.mousemove&&t.mousemove(...p),r(...p)},e.mouseInteractionCb=(...p)=>{t.mouseInteraction&&t.mouseInteraction(...p),o(...p)},e.scrollCb=(...p)=>{t.scroll&&t.scroll(...p),l(...p)},e.viewportResizeCb=(...p)=>{t.viewportResize&&t.viewportResize(...p),i(...p)},e.inputCb=(...p)=>{t.input&&t.input(...p),s(...p)},e.mediaInteractionCb=(...p)=>{t.mediaInteaction&&t.mediaInteaction(...p),a(...p)},e.styleSheetRuleCb=(...p)=>{t.styleSheetRule&&t.styleSheetRule(...p),c(...p)},e.styleDeclarationCb=(...p)=>{t.styleDeclaration&&t.styleDeclaration(...p),u(...p)},e.canvasMutationCb=(...p)=>{t.canvasMutation&&t.canvasMutation(...p),d(...p)},e.fontCb=(...p)=>{t.font&&t.font(...p),h(...p)},e.selectionCb=(...p)=>{t.selection&&t.selection(...p),m(...p)},e.customElementCb=(...p)=>{t.customElement&&t.customElement(...p),y(...p)}}function bo(e,t={}){const n=e.doc.defaultView;if(!n)return()=>{};So(e,t);let r;e.recordDOM&&(r=yn(e,e.doc));const o=ao(e),l=lo(e),i=gn(e),s=co(e,{win:n}),a=ho(e),c=fo(e);let u=()=>{},d=()=>{},h=()=>{},m=()=>{};e.recordDOM&&(u=po(e,{win:n}),d=Sn(e,e.doc),h=mo(e,{win:n}),e.collectFonts&&(m=yo(e)));const y=go(e),p=vo(e),v=[];for(const f of e.plugins)v.push(f.observer(f.callback,n,f.options));return k(()=>{ve.forEach(f=>f.reset()),r?.disconnect(),o(),l(),i(),s(),a(),c(),u(),d(),h(),m(),y(),p(),v.forEach(f=>f())})}function Ke(e){return typeof window[e]<"u"}function Ze(e){return Boolean(typeof window[e]<"u"&&window[e].prototype&&"insertRule"in window[e].prototype&&"deleteRule"in window[e].prototype)}class bn{constructor(t){this.generateIdFn=t,this.iframeIdToRemoteIdMap=new WeakMap,this.iframeRemoteIdToIdMap=new WeakMap}getId(t,n,r,o){const l=r||this.getIdToRemoteIdMap(t),i=o||this.getRemoteIdToIdMap(t);let s=l.get(n);return s||(s=this.generateIdFn(),l.set(n,s),i.set(s,n)),s}getIds(t,n){const r=this.getIdToRemoteIdMap(t),o=this.getRemoteIdToIdMap(t);return n.map(l=>this.getId(t,l,r,o))}getRemoteId(t,n,r){const o=r||this.getRemoteIdToIdMap(t);return typeof n!="number"?n:o.get(n)||-1}getRemoteIds(t,n){const r=this.getRemoteIdToIdMap(t);return n.map(o=>this.getRemoteId(t,o,r))}reset(t){if(!t){this.iframeIdToRemoteIdMap=new WeakMap,this.iframeRemoteIdToIdMap=new WeakMap;return}this.iframeIdToRemoteIdMap.delete(t),this.iframeRemoteIdToIdMap.delete(t)}getIdToRemoteIdMap(t){let n=this.iframeIdToRemoteIdMap.get(t);return n||(n=new Map,this.iframeIdToRemoteIdMap.set(t,n)),n}getRemoteIdToIdMap(t){let n=this.iframeRemoteIdToIdMap.get(t);return n||(n=new Map,this.iframeRemoteIdToIdMap.set(t,n)),n}}class wo{constructor(t){this.iframes=new WeakMap,this.crossOriginIframeMap=new WeakMap,this.crossOriginIframeMirror=new bn(Ht),this.crossOriginIframeRootIdMap=new WeakMap,this.mutationCb=t.mutationCb,this.wrappedEmit=t.wrappedEmit,this.stylesheetManager=t.stylesheetManager,this.recordCrossOriginIframes=t.recordCrossOriginIframes,this.crossOriginIframeStyleMirror=new bn(this.stylesheetManager.styleMirror.generateId.bind(this.stylesheetManager.styleMirror)),this.mirror=t.mirror,this.recordCrossOriginIframes&&window.addEventListener("message",this.handleMessage.bind(this))}addIframe(t){this.iframes.set(t,!0),t.contentWindow&&this.crossOriginIframeMap.set(t.contentWindow,t)}addLoadListener(t){this.loadListener=t}attachIframe(t,n){var r;this.mutationCb({adds:[{parentId:this.mirror.getId(t),nextId:null,node:n}],removes:[],texts:[],attributes:[],isAttachIframe:!0}),(r=this.loadListener)==null||r.call(this,t),t.contentDocument&&t.contentDocument.adoptedStyleSheets&&t.contentDocument.adoptedStyleSheets.length>0&&this.stylesheetManager.adoptStyleSheets(t.contentDocument.adoptedStyleSheets,this.mirror.getId(t.contentDocument))}handleMessage(t){const n=t;if(n.data.type!=="fpweb"||n.origin!==n.data.origin||!t.source)return;const r=this.crossOriginIframeMap.get(t.source);if(!r)return;const o=this.transformCrossOriginEvent(r,n.data.event);o&&this.wrappedEmit(o,n.data.isCheckout)}transformCrossOriginEvent(t,n){var r;switch(n.type){case M.FullSnapshot:{this.crossOriginIframeMirror.reset(t),this.crossOriginIframeStyleMirror.reset(t),this.replaceIdOnNode(n.data.node,t);const o=n.data.node.id;return this.crossOriginIframeRootIdMap.set(t,o),this.patchRootIdOnNode(n.data.node,o),{timestamp:n.timestamp,type:M.IncrementalSnapshot,data:{source:E.Mutation,adds:[{parentId:this.mirror.getId(t),nextId:null,node:n.data.node}],removes:[],texts:[],attributes:[],isAttachIframe:!0}}}case M.Meta:case M.Load:case M.DomContentLoaded:return!1;case M.Plugin:return n;case M.Custom:return this.replaceIds(n.data.payload,t,["id","parentId","previousId","nextId"]),n;case M.IncrementalSnapshot:switch(n.data.source){case E.Mutation:return n.data.adds.forEach(o=>{this.replaceIds(o,t,["parentId","nextId","previousId"]),this.replaceIdOnNode(o.node,t);const l=this.crossOriginIframeRootIdMap.get(t);l&&this.patchRootIdOnNode(o.node,l)}),n.data.removes.forEach(o=>{this.replaceIds(o,t,["parentId","id"])}),n.data.attributes.forEach(o=>{this.replaceIds(o,t,["id"])}),n.data.texts.forEach(o=>{this.replaceIds(o,t,["id"])}),n;case E.Drag:case E.TouchMove:case E.MouseMove:return n.data.positions.forEach(o=>{this.replaceIds(o,t,["id"])}),n;case E.ViewportResize:return!1;case E.MediaInteraction:case E.MouseInteraction:case E.Scroll:case E.CanvasMutation:case E.Input:return this.replaceIds(n.data,t,["id"]),n;case E.StyleSheetRule:case E.StyleDeclaration:return this.replaceIds(n.data,t,["id"]),this.replaceStyleIds(n.data,t,["styleId"]),n;case E.Font:return n;case E.Selection:return n.data.ranges.forEach(o=>{this.replaceIds(o,t,["start","end"])}),n;case E.AdoptedStyleSheet:return this.replaceIds(n.data,t,["id"]),this.replaceStyleIds(n.data,t,["styleIds"]),(r=n.data.styles)==null||r.forEach(o=>{this.replaceStyleIds(o,t,["styleId"])}),n}}return!1}replace(t,n,r,o){for(const l of o)!Array.isArray(n[l])&&typeof n[l]!="number"||(Array.isArray(n[l])?n[l]=t.getIds(r,n[l]):n[l]=t.getId(r,n[l]));return n}replaceIds(t,n,r){return this.replace(this.crossOriginIframeMirror,t,n,r)}replaceStyleIds(t,n,r){return this.replace(this.crossOriginIframeStyleMirror,t,n,r)}replaceIdOnNode(t,n){this.replaceIds(t,n,["id","rootId"]),"childNodes"in t&&t.childNodes.forEach(r=>{this.replaceIdOnNode(r,n)})}patchRootIdOnNode(t,n){t.type!==T.Document&&!t.rootId&&(t.rootId=n),"childNodes"in t&&t.childNodes.forEach(r=>{this.patchRootIdOnNode(r,n)})}}var Eo=Object.defineProperty,Co=Object.defineProperties,Mo=Object.getOwnPropertyDescriptors,wn=Object.getOwnPropertySymbols,To=Object.prototype.hasOwnProperty,No=Object.prototype.propertyIsEnumerable,En=(e,t,n)=>t in e?Eo(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Cn=(e,t)=>{for(var n in t||(t={}))To.call(t,n)&&En(e,n,t[n]);if(wn)for(var n of wn(t))No.call(t,n)&&En(e,n,t[n]);return e},Mn=(e,t)=>Co(e,Mo(t));class Io{constructor(t){this.shadowDoms=new WeakSet,this.restoreHandlers=[],this.mutationCb=t.mutationCb,this.scrollCb=t.scrollCb,this.bypassOptions=t.bypassOptions,this.mirror=t.mirror,this.init()}init(){this.reset(),this.patchAttachShadow(Element,document)}addShadowRoot(t,n){if(!Fe(t)||this.shadowDoms.has(t))return;this.shadowDoms.add(t);const r=yn(Mn(Cn({},this.bypassOptions),{doc:n,mutationCb:this.mutationCb,mirror:this.mirror,shadowDomManager:this}),t);this.restoreHandlers.push(()=>r.disconnect()),this.restoreHandlers.push(gn(Mn(Cn({},this.bypassOptions),{scrollCb:this.scrollCb,doc:t,mirror:this.mirror}))),setTimeout(()=>{t.adoptedStyleSheets&&t.adoptedStyleSheets.length>0&&this.bypassOptions.stylesheetManager.adoptStyleSheets(t.adoptedStyleSheets,this.mirror.getId(t.host)),this.restoreHandlers.push(Sn({mirror:this.mirror,stylesheetManager:this.bypassOptions.stylesheetManager},t))},0)}observeAttachShadow(t){!t.contentWindow||!t.contentDocument||this.patchAttachShadow(t.contentWindow.Element,t.contentDocument)}patchAttachShadow(t,n){const r=this;this.restoreHandlers.push(ge(t.prototype,"attachShadow",function(o){return function(l){const i=o.call(this,l);return this.shadowRoot&&Nt(this)&&r.addShadowRoot(this.shadowRoot,n),i}}))}reset(){this.restoreHandlers.forEach(t=>{try{t()}catch{}}),this.restoreHandlers=[],this.shadowDoms=new WeakSet}}for(var ke="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ve=typeof Uint8Array>"u"?[]:new Uint8Array(256),et=0;et<ke.length;et++)Ve[ke.charCodeAt(et)]=et;var Do=function(e){var t=new Uint8Array(e),n,r=t.length,o="";for(n=0;n<r;n+=3)o+=ke[t[n]>>2],o+=ke[(t[n]&3)<<4|t[n+1]>>4],o+=ke[(t[n+1]&15)<<2|t[n+2]>>6],o+=ke[t[n+2]&63];return r%3===2?o=o.substring(0,o.length-1)+"=":r%3===1&&(o=o.substring(0,o.length-2)+"=="),o},ko=function(e){var t=e.length*.75,n=e.length,r,o=0,l,i,s,a;e[e.length-1]==="="&&(t--,e[e.length-2]==="="&&t--);var c=new ArrayBuffer(t),u=new Uint8Array(c);for(r=0;r<n;r+=4)l=Ve[e.charCodeAt(r)],i=Ve[e.charCodeAt(r+1)],s=Ve[e.charCodeAt(r+2)],a=Ve[e.charCodeAt(r+3)],u[o++]=l<<2|i>>4,u[o++]=(i&15)<<4|s>>2,u[o++]=(s&3)<<6|a&63;return c};const Tn=new Map;function Ro(e,t){let n=Tn.get(e);return n||(n=new Map,Tn.set(e,n)),n.has(t)||n.set(t,[]),n.get(t)}const Nn=(e,t,n)=>{if(!e||!(Dn(e,t)||typeof e=="object"))return;const r=e.constructor.name,o=Ro(n,r);let l=o.indexOf(e);return l===-1&&(l=o.length,o.push(e)),l};function tt(e,t,n){if(e instanceof Array)return e.map(r=>tt(r,t,n));if(e===null)return e;if(e instanceof Float32Array||e instanceof Float64Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Int16Array||e instanceof Int8Array||e instanceof Uint8ClampedArray)return{rr_type:e.constructor.name,args:[Object.values(e)]};if(e instanceof ArrayBuffer){const r=e.constructor.name,o=Do(e);return{rr_type:r,base64:o}}else{if(e instanceof DataView)return{rr_type:e.constructor.name,args:[tt(e.buffer,t,n),e.byteOffset,e.byteLength]};if(e instanceof HTMLImageElement){const r=e.constructor.name,{src:o}=e;return{rr_type:r,src:o}}else if(e instanceof HTMLCanvasElement){const r="HTMLImageElement",o=e.toDataURL();return{rr_type:r,src:o}}else{if(e instanceof ImageData)return{rr_type:e.constructor.name,args:[tt(e.data,t,n),e.width,e.height]};if(Dn(e,t)||typeof e=="object"){const r=e.constructor.name,o=Nn(e,t,n);return{rr_type:r,index:o}}}}return e}const In=(e,t,n)=>e.map(r=>tt(r,t,n)),Dn=(e,t)=>{const n=["WebGLActiveInfo","WebGLBuffer","WebGLFramebuffer","WebGLProgram","WebGLRenderbuffer","WebGLShader","WebGLShaderPrecisionFormat","WebGLTexture","WebGLUniformLocation","WebGLVertexArrayObject","WebGLVertexArrayObjectOES"].filter(r=>typeof t[r]=="function");return Boolean(n.find(r=>e instanceof t[r]))};function Oo(e,t,n,r){const o=[],l=Object.getOwnPropertyNames(t.CanvasRenderingContext2D.prototype);for(const i of l)try{if(typeof t.CanvasRenderingContext2D.prototype[i]!="function")continue;const s=ge(t.CanvasRenderingContext2D.prototype,i,function(a){return function(...c){return X(this.canvas,n,r,!0)||setTimeout(()=>{const u=In(c,t,this);e(this.canvas,{type:ue["2D"],property:i,args:u})},0),a.apply(this,c)}});o.push(s)}catch{const a=Ue(t.CanvasRenderingContext2D.prototype,i,{set(c){e(this.canvas,{type:ue["2D"],property:i,args:[c],setter:!0})}});o.push(a)}return()=>{o.forEach(i=>i())}}function xo(e){return e==="experimental-webgl"?"webgl":e}function kn(e,t,n,r){const o=[];try{const l=ge(e.HTMLCanvasElement.prototype,"getContext",function(i){return function(s,...a){if(!X(this,t,n,!0)){const c=xo(s);if("__context"in this||(this.__context=c),r&&["webgl","webgl2"].includes(c))if(a[0]&&typeof a[0]=="object"){const u=a[0];u.preserveDrawingBuffer||(u.preserveDrawingBuffer=!0)}else a.splice(0,1,{preserveDrawingBuffer:!0})}return i.apply(this,[s,...a])}});o.push(l)}catch{console.error("failed to patch HTMLCanvasElement.prototype.getContext")}return()=>{o.forEach(l=>l())}}function Rn(e,t,n,r,o,l,i){const s=[],a=Object.getOwnPropertyNames(e);for(const c of a)if(!["isContextLost","canvas","drawingBufferWidth","drawingBufferHeight"].includes(c))try{if(typeof e[c]!="function")continue;const u=ge(e,c,function(d){return function(...h){const m=d.apply(this,h);if(Nn(m,i,this),"tagName"in this.canvas&&!X(this.canvas,r,o,!0)){const y=In(h,i,this),p={type:t,property:c,args:y};n(this.canvas,p)}return m}});s.push(u)}catch{const d=Ue(e,c,{set(h){n(this.canvas,{type:t,property:c,args:[h],setter:!0})}});s.push(d)}return s}function Ao(e,t,n,r,o){const l=[];return l.push(...Rn(t.WebGLRenderingContext.prototype,ue.WebGL,e,n,r,o,t)),typeof t.WebGL2RenderingContext<"u"&&l.push(...Rn(t.WebGL2RenderingContext.prototype,ue.WebGL2,e,n,r,o,t)),()=>{l.forEach(i=>i())}}function Lo(e,t){var n=t===void 0?null:t,r=e.toString(),o=r.split(`
`);o.pop(),o.shift();for(var l=o[0].search(/\S/),i=/(['"])__worker_loader_strict__(['"])/g,s=0,a=o.length;s<a;++s)o[s]=o[s].substring(l).replace(i,"$1use strict$2")+`
`;return n&&o.push("//# sourceMappingURL="+n+`
`),o}function _o(e,t){var n=Lo(e,t),r=new Blob(n,{type:"application/javascript"});return URL.createObjectURL(r)}function Fo(e,t){var n;return function(o){return n=n||_o(e,t),new Worker(n,o)}}var Po=Fo(function(){(function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=typeof Uint8Array>"u"?[]:new Uint8Array(256),n=0;n<e.length;n++)t[e.charCodeAt(n)]=n;var r=function(a){var c=new Uint8Array(a),u,d=c.length,h="";for(u=0;u<d;u+=3)h+=e[c[u]>>2],h+=e[(c[u]&3)<<4|c[u+1]>>4],h+=e[(c[u+1]&15)<<2|c[u+2]>>6],h+=e[c[u+2]&63];return d%3===2?h=h.substring(0,h.length-1)+"=":d%3===1&&(h=h.substring(0,h.length-2)+"=="),h};const o=new Map,l=new Map;async function i(a,c,u){const d=`${a}-${c}`;if("OffscreenCanvas"in globalThis){if(l.has(d))return l.get(d);const h=new OffscreenCanvas(a,c);h.getContext("2d");const m=await(await h.convertToBlob(u)).arrayBuffer(),y=r(m);return l.set(d,y),y}else return""}const s=self;s.onmessage=async function(a){if("OffscreenCanvas"in globalThis){const{id:c,bitmap:u,width:d,height:h,dataURLOptions:m}=a.data,y=i(d,h,m),p=new OffscreenCanvas(d,h);p.getContext("2d").drawImage(u,0,0),u.close();const v=await p.convertToBlob(m),f=v.type,S=await v.arrayBuffer(),g=r(S);if(!o.has(c)&&await y===g)return o.set(c,g),s.postMessage({id:c});if(o.get(c)===g)return s.postMessage({id:c});s.postMessage({id:c,type:f,base64:g,width:d,height:h}),o.set(c,g)}else return s.postMessage({id:a.data.id})}})()},null),On=Object.getOwnPropertySymbols,$o=Object.prototype.hasOwnProperty,Uo=Object.prototype.propertyIsEnumerable,Wo=(e,t)=>{var n={};for(var r in e)$o.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&On)for(var r of On(e))t.indexOf(r)<0&&Uo.call(e,r)&&(n[r]=e[r]);return n},Bo=(e,t,n)=>new Promise((r,o)=>{var l=a=>{try{s(n.next(a))}catch(c){o(c)}},i=a=>{try{s(n.throw(a))}catch(c){o(c)}},s=a=>a.done?r(a.value):Promise.resolve(a.value).then(l,i);s((n=n.apply(e,t)).next())});class jo{constructor(t){this.pendingCanvasMutations=new Map,this.rafStamps={latestId:0,invokeId:null},this.frozen=!1,this.locked=!1,this.processMutation=(a,c)=>{(this.rafStamps.invokeId&&this.rafStamps.latestId!==this.rafStamps.invokeId||!this.rafStamps.invokeId)&&(this.rafStamps.invokeId=this.rafStamps.latestId),this.pendingCanvasMutations.has(a)||this.pendingCanvasMutations.set(a,[]),this.pendingCanvasMutations.get(a).push(c)};const{sampling:n="all",win:r,blockClass:o,blockSelector:l,recordCanvas:i,dataURLOptions:s}=t;this.mutationCb=t.mutationCb,this.mirror=t.mirror,i&&n==="all"&&this.initCanvasMutationObserver(r,o,l),i&&typeof n=="number"&&this.initCanvasFPSObserver(n,r,o,l,{dataURLOptions:s})}reset(){this.pendingCanvasMutations.clear(),this.resetObservers&&this.resetObservers()}freeze(){this.frozen=!0}unfreeze(){this.frozen=!1}lock(){this.locked=!0}unlock(){this.locked=!1}initCanvasFPSObserver(t,n,r,o,l){const i=kn(n,r,o,!0),s=new Map,a=new Po;a.onmessage=y=>{const{id:p}=y.data;if(s.set(p,!1),!("base64"in y.data))return;const{base64:v,type:f,width:S,height:g}=y.data;this.mutationCb({id:p,type:ue["2D"],commands:[{property:"clearRect",args:[0,0,S,g]},{property:"drawImage",args:[{rr_type:"ImageBitmap",args:[{rr_type:"Blob",data:[{rr_type:"ArrayBuffer",base64:v}],type:f}]},0,0]}]})};const c=1e3/t;let u=0,d;const h=()=>{const y=[];return n.document.querySelectorAll("canvas").forEach(p=>{X(p,r,o,!0)||y.push(p)}),y},m=y=>{if(u&&y-u<c){d=requestAnimationFrame(m);return}u=y,h().forEach(p=>Bo(this,null,function*(){var v;const f=this.mirror.getId(p);if(s.get(f))return;if(s.set(f,!0),["webgl","webgl2"].includes(p.__context)){const g=p.getContext(p.__context);((v=g?.getContextAttributes())==null?void 0:v.preserveDrawingBuffer)===!1&&g.clear(g.COLOR_BUFFER_BIT)}const S=yield createImageBitmap(p);a.postMessage({id:f,bitmap:S,width:p.width,height:p.height,dataURLOptions:l.dataURLOptions},[S])})),d=requestAnimationFrame(m)};d=requestAnimationFrame(m),this.resetObservers=()=>{i(),cancelAnimationFrame(d)}}initCanvasMutationObserver(t,n,r){this.startRAFTimestamping(),this.startPendingCanvasMutationFlusher();const o=kn(t,n,r,!1),l=Oo(this.processMutation.bind(this),t,n,r),i=Ao(this.processMutation.bind(this),t,n,r,this.mirror);this.resetObservers=()=>{o(),l(),i()}}startPendingCanvasMutationFlusher(){requestAnimationFrame(()=>this.flushPendingCanvasMutations())}startRAFTimestamping(){const t=n=>{this.rafStamps.latestId=n,requestAnimationFrame(t)};requestAnimationFrame(t)}flushPendingCanvasMutations(){this.pendingCanvasMutations.forEach((t,n)=>{const r=this.mirror.getId(n);this.flushPendingCanvasMutationFor(n,r)}),requestAnimationFrame(()=>this.flushPendingCanvasMutations())}flushPendingCanvasMutationFor(t,n){if(this.frozen||this.locked)return;const r=this.pendingCanvasMutations.get(t);if(!r||n===-1)return;const o=r.map(i=>Wo(i,["type"])),{type:l}=r[0];this.mutationCb({id:n,type:l,commands:o}),this.pendingCanvasMutations.delete(t)}}class Vo{constructor(t){this.trackedLinkElements=new WeakSet,this.styleMirror=new Mt,this.mutationCb=t.mutationCb,this.adoptedStyleSheetCb=t.adoptedStyleSheetCb}attachLinkElement(t,n){"_cssText"in n.attributes&&this.mutationCb({adds:[],removes:[],texts:[],attributes:[{id:n.id,attributes:n.attributes}]}),this.trackLinkElement(t)}trackLinkElement(t){this.trackedLinkElements.has(t)||(this.trackedLinkElements.add(t),this.trackStylesheetInLinkElement(t))}adoptStyleSheets(t,n){if(t.length===0)return;const r={id:n,styleIds:[]},o=[];for(const l of t){let i;this.styleMirror.has(l)?i=this.styleMirror.getId(l):(i=this.styleMirror.add(l),o.push({styleId:i,rules:Array.from(l.rules||CSSRule,(s,a)=>({rule:jt(s),index:a}))})),r.styleIds.push(i)}o.length>0&&(r.styles=o),this.adoptedStyleSheetCb(r)}reset(){this.styleMirror.reset(),this.trackedLinkElements=new WeakSet}trackStylesheetInLinkElement(t){}}class zo{constructor(){this.nodeMap=new WeakMap,this.loop=!0,this.periodicallyClear()}periodicallyClear(){requestAnimationFrame(()=>{this.clear(),this.loop&&this.periodicallyClear()})}inOtherBuffer(t,n){const r=this.nodeMap.get(t);return r&&Array.from(r).some(o=>o!==n)}add(t,n){this.nodeMap.set(t,(this.nodeMap.get(t)||new Set).add(n))}clear(){this.nodeMap=new WeakMap}destroy(){this.loop=!1}}var Ho=Object.defineProperty,Go=Object.defineProperties,Yo=Object.getOwnPropertyDescriptors,xn=Object.getOwnPropertySymbols,Xo=Object.prototype.hasOwnProperty,qo=Object.prototype.propertyIsEnumerable,An=(e,t,n)=>t in e?Ho(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Z=(e,t)=>{for(var n in t||(t={}))Xo.call(t,n)&&An(e,n,t[n]);if(xn)for(var n of xn(t))qo.call(t,n)&&An(e,n,t[n]);return e},Qo=(e,t)=>Go(e,Yo(t));function B(e){return Qo(Z({},e),{timestamp:We()})}let $,nt,Dt,rt=!1;const se=Vt();function Se(e={}){const{emit:t,checkoutEveryNms:n,checkoutEveryNth:r,blockClass:o="rr-block",blockSelector:l=null,ignoreClass:i="rr-ignore",ignoreSelector:s=null,maskTextClass:a="rr-mask",maskTextSelector:c=null,inlineStylesheet:u=!0,maskAllInputs:d,maskInputOptions:h,slimDOMOptions:m,maskInputFn:y,maskTextFn:p,hooks:v,packFn:f,sampling:S={},dataURLOptions:g={},mousemoveWait:w,recordDOM:N=!0,recordCanvas:x=!1,recordCrossOriginIframes:j=!1,recordAfter:V=e.recordAfter==="DOMContentLoaded"?e.recordAfter:"load",userTriggeredOnInput:Q=!1,collectFonts:J=!1,inlineImages:ne=!1,plugins:A,keepIframeSrcFn:re=()=>!1,ignoreCSSAttributes:H=new Set([]),errorHandler:oe}=e;Zr(oe);const G=j?window.parent===window:!0;let P=!1;if(!G)try{window.parent.document&&(P=!1)}catch{P=!0}if(G&&!t)throw new Error("emit function is required");w!==void 0&&S.mousemove===void 0&&(S.mousemove=w),se.reset();const he=d===!0?{color:!0,date:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0,textarea:!0,select:!0,password:!0}:h!==void 0?h:{password:!0},C=m===!0||m==="all"?{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaVerification:!0,headMetaAuthorship:m==="all",headMetaDescKeywords:m==="all"}:m||{};St();let b,R=0;const z=I=>{for(const ie of A||[])ie.eventProcessor&&(I=ie.eventProcessor(I));return f&&!P&&(I=f(I)),I};$=(I,ie)=>{var W;if(((W=ve[0])==null?void 0:W.isFrozen())&&I.type!==M.FullSnapshot&&!(I.type===M.IncrementalSnapshot&&I.data.source===E.Mutation)&&ve.forEach(K=>K.unfreeze()),G)t?.(z(I),ie);else if(P){const K={type:"fpweb",event:z(I),origin:window.location.origin,isCheckout:ie};window.parent.postMessage(K,"*")}if(I.type===M.FullSnapshot)b=I,R=0;else if(I.type===M.IncrementalSnapshot){if(I.data.source===E.Mutation&&I.data.isAttachIframe)return;R++;const K=r&&R>=r,Le=n&&I.timestamp-b.timestamp>n;(K||Le)&&nt(!0)}};const ee=I=>{$(B({type:M.IncrementalSnapshot,data:Z({source:E.Mutation},I)}))},be=I=>$(B({type:M.IncrementalSnapshot,data:Z({source:E.Scroll},I)})),hr=I=>$(B({type:M.IncrementalSnapshot,data:Z({source:E.CanvasMutation},I)})),ei=I=>$(B({type:M.IncrementalSnapshot,data:Z({source:E.AdoptedStyleSheet},I)})),we=new Vo({mutationCb:ee,adoptedStyleSheetCb:ei}),Ee=new wo({mirror:se,mutationCb:ee,stylesheetManager:we,recordCrossOriginIframes:j,wrappedEmit:$});for(const I of A||[])I.getMirror&&I.getMirror({nodeMirror:se,crossOriginIframeMirror:Ee.crossOriginIframeMirror,crossOriginIframeStyleMirror:Ee.crossOriginIframeStyleMirror});const Ut=new zo;Dt=new jo({recordCanvas:x,mutationCb:hr,win:window,blockClass:o,blockSelector:l,mirror:se,sampling:S.canvas,dataURLOptions:g});const lt=new Io({mutationCb:ee,scrollCb:be,bypassOptions:{blockClass:o,blockSelector:l,maskTextClass:a,maskTextSelector:c,inlineStylesheet:u,maskInputOptions:he,dataURLOptions:g,maskTextFn:p,maskInputFn:y,recordCanvas:x,inlineImages:ne,sampling:S,slimDOMOptions:C,iframeManager:Ee,stylesheetManager:we,canvasManager:Dt,keepIframeSrcFn:re,processedNodeManager:Ut},mirror:se});nt=(I=!1)=>{if(!N)return;$(B({type:M.Meta,data:{href:window.location.href,width:yt(),height:ft()}}),I),we.reset(),lt.init(),ve.forEach(W=>W.lock());const ie=Br(document,{mirror:se,blockClass:o,blockSelector:l,maskTextClass:a,maskTextSelector:c,inlineStylesheet:u,maskAllInputs:he,maskTextFn:p,slimDOM:C,dataURLOptions:g,recordCanvas:x,inlineImages:ne,onSerialize:W=>{Ie(W,se)&&Ee.addIframe(W),wt(W,se)&&we.trackLinkElement(W),me(W)&&lt.addShadowRoot(W.shadowRoot,document)},onIframeLoad:(W,K)=>{Ee.attachIframe(W,K),lt.observeAttachShadow(W)},onStylesheetLoad:(W,K)=>{we.attachLinkElement(W,K)},keepIframeSrcFn:re});if(!ie)return console.warn("Failed to snapshot the document");$(B({type:M.FullSnapshot,data:{node:ie,initialOffset:mt(window)}}),I),ve.forEach(W=>W.unlock()),document.adoptedStyleSheets&&document.adoptedStyleSheets.length>0&&we.adoptStyleSheets(document.adoptedStyleSheets,se.getId(document))};try{const I=[],ie=K=>{var Le;return k(bo)({mutationCb:ee,mousemoveCb:(F,Wt)=>$(B({type:M.IncrementalSnapshot,data:{source:Wt,positions:F}})),mouseInteractionCb:F=>$(B({type:M.IncrementalSnapshot,data:Z({source:E.MouseInteraction},F)})),scrollCb:be,viewportResizeCb:F=>$(B({type:M.IncrementalSnapshot,data:Z({source:E.ViewportResize},F)})),inputCb:F=>$(B({type:M.IncrementalSnapshot,data:Z({source:E.Input},F)})),mediaInteractionCb:F=>$(B({type:M.IncrementalSnapshot,data:Z({source:E.MediaInteraction},F)})),styleSheetRuleCb:F=>$(B({type:M.IncrementalSnapshot,data:Z({source:E.StyleSheetRule},F)})),styleDeclarationCb:F=>$(B({type:M.IncrementalSnapshot,data:Z({source:E.StyleDeclaration},F)})),canvasMutationCb:hr,fontCb:F=>$(B({type:M.IncrementalSnapshot,data:Z({source:E.Font},F)})),selectionCb:F=>{$(B({type:M.IncrementalSnapshot,data:Z({source:E.Selection},F)}))},customElementCb:F=>{$(B({type:M.IncrementalSnapshot,data:Z({source:E.CustomElement},F)}))},blockClass:o,ignoreClass:i,ignoreSelector:s,maskTextClass:a,maskTextSelector:c,maskInputOptions:he,inlineStylesheet:u,sampling:S,recordDOM:N,recordCanvas:x,inlineImages:ne,userTriggeredOnInput:Q,collectFonts:J,doc:K,maskInputFn:y,maskTextFn:p,keepIframeSrcFn:re,blockSelector:l,slimDOMOptions:C,dataURLOptions:g,mirror:se,iframeManager:Ee,stylesheetManager:we,shadowDomManager:lt,processedNodeManager:Ut,canvasManager:Dt,ignoreCSSAttributes:H,plugins:((Le=A?.filter(F=>F.observer))==null?void 0:Le.map(F=>({observer:F.observer,options:F.options,callback:Wt=>$(B({type:M.Plugin,data:{plugin:F.name,payload:Wt}}))})))||[]},v)};Ee.addLoadListener(K=>{try{I.push(ie(K.contentDocument))}catch(Le){console.warn(Le)}});const W=()=>{nt(),I.push(ie(document)),rt=!0};return document.readyState==="interactive"||document.readyState==="complete"?W():(I.push(Y("DOMContentLoaded",()=>{$(B({type:M.DomContentLoaded,data:{}})),V==="DOMContentLoaded"&&W()})),I.push(Y("load",()=>{$(B({type:M.Load,data:{}})),V==="load"&&W()},window))),()=>{I.forEach(K=>K()),Ut.destroy(),rt=!1,eo()}}catch(I){console.warn(I)}}Se.addCustomEvent=(e,t)=>{if(!rt)throw new Error("please add custom event after start recording");$(B({type:M.Custom,data:{tag:e,payload:t}}))},Se.freezePage=()=>{ve.forEach(e=>e.freeze())},Se.takeFullSnapshot=e=>{if(!rt)throw new Error("please take full snapshot after start recording");nt(e)},Se.mirror=se;var D;(function(e){e[e.Document=0]="Document",e[e.DocumentType=1]="DocumentType",e[e.Element=2]="Element",e[e.Text=3]="Text",e[e.CDATA=4]="CDATA",e[e.Comment=5]="Comment"})(D||(D={}));class Jo{constructor(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap}getId(t){var n;if(!t)return-1;const r=(n=this.getMeta(t))===null||n===void 0?void 0:n.id;return r??-1}getNode(t){return this.idNodeMap.get(t)||null}getIds(){return Array.from(this.idNodeMap.keys())}getMeta(t){return this.nodeMetaMap.get(t)||null}removeNodeFromMap(t){const n=this.getId(t);this.idNodeMap.delete(n),t.childNodes&&t.childNodes.forEach(r=>this.removeNodeFromMap(r))}has(t){return this.idNodeMap.has(t)}hasNode(t){return this.nodeMetaMap.has(t)}add(t,n){const r=n.id;this.idNodeMap.set(r,t),this.nodeMetaMap.set(t,n)}replace(t,n){const r=this.getNode(t);if(r){const o=this.nodeMetaMap.get(r);o&&this.nodeMetaMap.set(n,o)}this.idNodeMap.set(t,n)}reset(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap}}function Ko(){return new Jo}function Zo(e){const t={},n=/;(?![^(]*\))/g,r=/:(.+)/,o=/\/\*.*?\*\//g;return e.replace(o,"").split(n).forEach(function(l){if(l){const i=l.split(r);i.length>1&&(t[kt(i[0].trim())]=i[1].trim())}}),t}function Ln(e){const t=[];for(const n in e){const r=e[n];if(typeof r!="string")continue;const o=rs(n);t.push(`${o}: ${r};`)}return t.join(" ")}const es=/-([a-z])/g,ts=/^--[a-zA-Z0-9-]+$/,kt=e=>ts.test(e)?e:e.replace(es,(t,n)=>n?n.toUpperCase():""),ns=/\B([A-Z])/g,rs=e=>e.replace(ns,"-$1").toLowerCase();class te{constructor(...t){this.parentElement=null,this.parentNode=null,this.firstChild=null,this.lastChild=null,this.previousSibling=null,this.nextSibling=null,this.ELEMENT_NODE=U.ELEMENT_NODE,this.TEXT_NODE=U.TEXT_NODE}get childNodes(){const t=[];let n=this.firstChild;for(;n;)t.push(n),n=n.nextSibling;return t}contains(t){if(t instanceof te){if(t.ownerDocument!==this.ownerDocument)return!1;if(t===this)return!0}else return!1;for(;t.parentNode;){if(t.parentNode===this)return!0;t=t.parentNode}return!1}appendChild(t){throw new Error("RRDomException: Failed to execute 'appendChild' on 'RRNode': This RRNode type does not support this method.")}insertBefore(t,n){throw new Error("RRDomException: Failed to execute 'insertBefore' on 'RRNode': This RRNode type does not support this method.")}removeChild(t){throw new Error("RRDomException: Failed to execute 'removeChild' on 'RRNode': This RRNode type does not support this method.")}toString(){return"RRNode"}}function os(e){return class pr extends e{constructor(...n){super(n),this.nodeType=U.DOCUMENT_NODE,this.nodeName="#document",this.compatMode="CSS1Compat",this.RRNodeType=D.Document,this.textContent=null,this.ownerDocument=this}get documentElement(){return this.childNodes.find(n=>n.RRNodeType===D.Element&&n.tagName==="HTML")||null}get body(){var n;return((n=this.documentElement)===null||n===void 0?void 0:n.childNodes.find(r=>r.RRNodeType===D.Element&&r.tagName==="BODY"))||null}get head(){var n;return((n=this.documentElement)===null||n===void 0?void 0:n.childNodes.find(r=>r.RRNodeType===D.Element&&r.tagName==="HEAD"))||null}get implementation(){return this}get firstElementChild(){return this.documentElement}appendChild(n){const r=n.RRNodeType;if((r===D.Element||r===D.DocumentType)&&this.childNodes.some(l=>l.RRNodeType===r))throw new Error(`RRDomException: Failed to execute 'appendChild' on 'RRNode': Only one ${r===D.Element?"RRElement":"RRDoctype"} on RRDocument allowed.`);const o=Rt(this,n);return o.parentElement=null,o}insertBefore(n,r){const o=n.RRNodeType;if((o===D.Element||o===D.DocumentType)&&this.childNodes.some(i=>i.RRNodeType===o))throw new Error(`RRDomException: Failed to execute 'insertBefore' on 'RRNode': Only one ${o===D.Element?"RRElement":"RRDoctype"} on RRDocument allowed.`);const l=Wn(this,n,r);return l.parentElement=null,l}removeChild(n){return Bn(this,n)}open(){this.firstChild=null,this.lastChild=null}close(){}write(n){let r;if(n==='<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "">'?r="-//W3C//DTD XHTML 1.0 Transitional//EN":n==='<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "">'&&(r="-//W3C//DTD HTML 4.0 Transitional//EN"),r){const o=this.createDocumentType("html",r,"");this.open(),this.appendChild(o)}}createDocument(n,r,o){return new pr}createDocumentType(n,r,o){const l=new(_n(te))(n,r,o);return l.ownerDocument=this,l}createElement(n){const r=new(Fn(te))(n);return r.ownerDocument=this,r}createElementNS(n,r){return this.createElement(r)}createTextNode(n){const r=new(Pn(te))(n);return r.ownerDocument=this,r}createComment(n){const r=new($n(te))(n);return r.ownerDocument=this,r}createCDATASection(n){const r=new(Un(te))(n);return r.ownerDocument=this,r}toString(){return"RRDocument"}}}function _n(e){return class extends e{constructor(t,n,r){super(),this.nodeType=U.DOCUMENT_TYPE_NODE,this.RRNodeType=D.DocumentType,this.name=t,this.publicId=n,this.systemId=r,this.nodeName=t,this.textContent=null}toString(){return"RRDocumentType"}}}function Fn(e){return class extends e{constructor(t){super(),this.nodeType=U.ELEMENT_NODE,this.RRNodeType=D.Element,this.attributes={},this.shadowRoot=null,this.tagName=t.toUpperCase(),this.nodeName=t.toUpperCase()}get textContent(){let t="";return this.childNodes.forEach(n=>t+=n.textContent),t}set textContent(t){this.firstChild=null,this.lastChild=null,this.appendChild(this.ownerDocument.createTextNode(t))}get classList(){return new is(this.attributes.class,t=>{this.attributes.class=t})}get id(){return this.attributes.id||""}get className(){return this.attributes.class||""}get style(){const t=this.attributes.style?Zo(this.attributes.style):{},n=/\B([A-Z])/g;return t.setProperty=(r,o,l)=>{if(n.test(r))return;const i=kt(r);o?t[i]=o:delete t[i],l==="important"&&(t[i]+=" !important"),this.attributes.style=Ln(t)},t.removeProperty=r=>{if(n.test(r))return"";const o=kt(r),l=t[o]||"";return delete t[o],this.attributes.style=Ln(t),l},t}getAttribute(t){return this.attributes[t]||null}setAttribute(t,n){this.attributes[t]=n}setAttributeNS(t,n,r){this.setAttribute(n,r)}removeAttribute(t){delete this.attributes[t]}appendChild(t){return Rt(this,t)}insertBefore(t,n){return Wn(this,t,n)}removeChild(t){return Bn(this,t)}attachShadow(t){const n=this.ownerDocument.createElement("SHADOWROOT");return this.shadowRoot=n,n}dispatchEvent(t){return!0}toString(){let t="";for(const n in this.attributes)t+=`${n}="${this.attributes[n]}" `;return`${this.tagName} ${t}`}}}function ss(e){return class extends e{attachShadow(t){throw new Error("RRDomException: Failed to execute 'attachShadow' on 'RRElement': This RRElement does not support attachShadow")}play(){this.paused=!1}pause(){this.paused=!0}}}function Pn(e){return class extends e{constructor(t){super(),this.nodeType=U.TEXT_NODE,this.nodeName="#text",this.RRNodeType=D.Text,this.data=t}get textContent(){return this.data}set textContent(t){this.data=t}toString(){return`RRText text=${JSON.stringify(this.data)}`}}}function $n(e){return class extends e{constructor(t){super(),this.nodeType=U.COMMENT_NODE,this.nodeName="#comment",this.RRNodeType=D.Comment,this.data=t}get textContent(){return this.data}set textContent(t){this.data=t}toString(){return`RRComment text=${JSON.stringify(this.data)}`}}}function Un(e){return class extends e{constructor(t){super(),this.nodeName="#cdata-section",this.nodeType=U.CDATA_SECTION_NODE,this.RRNodeType=D.CDATA,this.data=t}get textContent(){return this.data}set textContent(t){this.data=t}toString(){return`RRCDATASection data=${JSON.stringify(this.data)}`}}}class is{constructor(t,n){if(this.classes=[],this.add=(...r)=>{for(const o of r){const l=String(o);this.classes.indexOf(l)>=0||this.classes.push(l)}this.onChange&&this.onChange(this.classes.join(" "))},this.remove=(...r)=>{this.classes=this.classes.filter(o=>r.indexOf(o)===-1),this.onChange&&this.onChange(this.classes.join(" "))},t){const r=t.trim().split(/\s+/);this.classes.push(...r)}this.onChange=n}}function Rt(e,t){return t.parentNode&&t.parentNode.removeChild(t),e.lastChild?(e.lastChild.nextSibling=t,t.previousSibling=e.lastChild):(e.firstChild=t,t.previousSibling=null),e.lastChild=t,t.nextSibling=null,t.parentNode=e,t.parentElement=e,t.ownerDocument=e.ownerDocument,t}function Wn(e,t,n){if(!n)return Rt(e,t);if(n.parentNode!==e)throw new Error("Failed to execute 'insertBefore' on 'RRNode': The RRNode before which the new node is to be inserted is not a child of this RRNode.");return t===n||(t.parentNode&&t.parentNode.removeChild(t),t.previousSibling=n.previousSibling,n.previousSibling=t,t.nextSibling=n,t.previousSibling?t.previousSibling.nextSibling=t:e.firstChild=t,t.parentElement=e,t.parentNode=e,t.ownerDocument=e.ownerDocument),t}function Bn(e,t){if(t.parentNode!==e)throw new Error("Failed to execute 'removeChild' on 'RRNode': The RRNode to be removed is not a child of this RRNode.");return t.previousSibling?t.previousSibling.nextSibling=t.nextSibling:e.firstChild=t.nextSibling,t.nextSibling?t.nextSibling.previousSibling=t.previousSibling:e.lastChild=t.previousSibling,t.previousSibling=null,t.nextSibling=null,t.parentElement=null,t.parentNode=null,t}var U;(function(e){e[e.PLACEHOLDER=0]="PLACEHOLDER",e[e.ELEMENT_NODE=1]="ELEMENT_NODE",e[e.ATTRIBUTE_NODE=2]="ATTRIBUTE_NODE",e[e.TEXT_NODE=3]="TEXT_NODE",e[e.CDATA_SECTION_NODE=4]="CDATA_SECTION_NODE",e[e.ENTITY_REFERENCE_NODE=5]="ENTITY_REFERENCE_NODE",e[e.ENTITY_NODE=6]="ENTITY_NODE",e[e.PROCESSING_INSTRUCTION_NODE=7]="PROCESSING_INSTRUCTION_NODE",e[e.COMMENT_NODE=8]="COMMENT_NODE",e[e.DOCUMENT_NODE=9]="DOCUMENT_NODE",e[e.DOCUMENT_TYPE_NODE=10]="DOCUMENT_TYPE_NODE",e[e.DOCUMENT_FRAGMENT_NODE=11]="DOCUMENT_FRAGMENT_NODE"})(U||(U={}));const Ot={svg:"http://www.w3.org/2000/svg","xlink:href":"http://www.w3.org/1999/xlink",xmlns:"http://www.w3.org/2000/xmlns/"},as={altglyph:"altGlyph",altglyphdef:"altGlyphDef",altglyphitem:"altGlyphItem",animatecolor:"animateColor",animatemotion:"animateMotion",animatetransform:"animateTransform",clippath:"clipPath",feblend:"feBlend",fecolormatrix:"feColorMatrix",fecomponenttransfer:"feComponentTransfer",fecomposite:"feComposite",feconvolvematrix:"feConvolveMatrix",fediffuselighting:"feDiffuseLighting",fedisplacementmap:"feDisplacementMap",fedistantlight:"feDistantLight",fedropshadow:"feDropShadow",feflood:"feFlood",fefunca:"feFuncA",fefuncb:"feFuncB",fefuncg:"feFuncG",fefuncr:"feFuncR",fegaussianblur:"feGaussianBlur",feimage:"feImage",femerge:"feMerge",femergenode:"feMergeNode",femorphology:"feMorphology",feoffset:"feOffset",fepointlight:"fePointLight",fespecularlighting:"feSpecularLighting",fespotlight:"feSpotLight",fetile:"feTile",feturbulence:"feTurbulence",foreignobject:"foreignObject",glyphref:"glyphRef",lineargradient:"linearGradient",radialgradient:"radialGradient"};let ae=null;function ot(e,t,n,r=t.mirror||t.ownerDocument.mirror){e=ls(e,t,n,r),jn(e,t,n,r),cs(e,t,n,r)}function ls(e,t,n,r){var o;if(n.afterAppend&&!ae&&(ae=new WeakSet,setTimeout(()=>{ae=null},0)),!xt(e,t)){const l=st(t,n.mirror,r);(o=e.parentNode)===null||o===void 0||o.replaceChild(l,e),e=l}switch(t.RRNodeType){case D.Document:{if(!Re(e,t,n.mirror,r)){const l=r.getMeta(t);l&&(n.mirror.removeNodeFromMap(e),e.close(),e.open(),n.mirror.add(e,l),ae?.add(e))}break}case D.Element:{const l=e,i=t;switch(i.tagName){case"IFRAME":{const s=e.contentDocument;if(!s)break;ot(s,t.contentDocument,n,r);break}}i.shadowRoot&&(l.shadowRoot||l.attachShadow({mode:"open"}),jn(l.shadowRoot,i.shadowRoot,n,r));break}}return e}function cs(e,t,n,r){var o;switch(t.RRNodeType){case D.Document:{const l=t.scrollData;l&&n.applyScroll(l,!0);break}case D.Element:{const l=e,i=t;switch(us(l,i,r),i.scrollData&&n.applyScroll(i.scrollData,!0),i.inputData&&n.applyInput(i.inputData),i.tagName){case"AUDIO":case"VIDEO":{const s=e,a=i;a.paused!==void 0&&(a.paused?s.pause():s.play()),a.muted!==void 0&&(s.muted=a.muted),a.volume!==void 0&&(s.volume=a.volume),a.currentTime!==void 0&&(s.currentTime=a.currentTime),a.playbackRate!==void 0&&(s.playbackRate=a.playbackRate);break}case"CANVAS":{const s=t;if(s.rr_dataURL!==null){const a=document.createElement("img");a.onload=()=>{const c=l.getContext("2d");c&&c.drawImage(a,0,0,a.width,a.height)},a.src=s.rr_dataURL}s.canvasMutations.forEach(a=>n.applyCanvas(a.event,a.mutation,e));break}case"STYLE":{const s=l.sheet;s&&t.rules.forEach(a=>n.applyStyleSheetMutation(a,s));break}}break}case D.Text:case D.Comment:case D.CDATA:{e.textContent!==t.data&&(e.textContent=t.data);break}}ae!=null&&ae.has(e)&&(ae.delete(e),(o=n.afterAppend)===null||o===void 0||o.call(n,e,n.mirror.getId(e)))}function us(e,t,n){const r=e.attributes,o=t.attributes;for(const l in o){const i=o[l],s=n.getMeta(t);if(s?.isSVG&&Ot[l])e.setAttributeNS(Ot[l],l,i);else if(t.tagName==="CANVAS"&&l==="rr_dataURL"){const a=document.createElement("img");a.src=i,a.onload=()=>{const c=e.getContext("2d");c&&c.drawImage(a,0,0,a.width,a.height)}}else{if(t.tagName==="IFRAME"&&l==="srcdoc")continue;e.setAttribute(l,i)}}for(const{name:l}of Array.from(r))l in o||e.removeAttribute(l);t.scrollLeft&&(e.scrollLeft=t.scrollLeft),t.scrollTop&&(e.scrollTop=t.scrollTop)}function jn(e,t,n,r){const o=Array.from(e.childNodes),l=t.childNodes;if(o.length===0&&l.length===0)return;let i=0,s=o.length-1,a=0,c=l.length-1,u=o[i],d=o[s],h=l[a],m=l[c],y,p;for(;i<=s&&a<=c;)if(u===void 0)u=o[++i];else if(d===void 0)d=o[--s];else if(Re(u,h,n.mirror,r))u=o[++i],h=l[++a];else if(Re(d,m,n.mirror,r))d=o[--s],m=l[--c];else if(Re(u,m,n.mirror,r)){try{e.insertBefore(u,d.nextSibling)}catch(S){console.warn(S)}u=o[++i],m=l[--c]}else if(Re(d,h,n.mirror,r)){try{e.insertBefore(d,u)}catch(S){console.warn(S)}d=o[--s],h=l[++a]}else{if(!y){y={};for(let g=i;g<=s;g++){const w=o[g];w&&n.mirror.hasNode(w)&&(y[n.mirror.getId(w)]=g)}}p=y[r.getId(h)];const S=o[p];if(p!==void 0&&S&&Re(S,h,n.mirror,r)){try{e.insertBefore(S,u)}catch(g){console.warn(g)}o[p]=void 0}else{const g=st(h,n.mirror,r);e.nodeName==="#document"&&u&&(g.nodeType===g.DOCUMENT_TYPE_NODE&&u.nodeType===u.DOCUMENT_TYPE_NODE||g.nodeType===g.ELEMENT_NODE&&u.nodeType===u.ELEMENT_NODE)&&(e.removeChild(u),n.mirror.removeNodeFromMap(u),u=o[++i]);try{e.insertBefore(g,u||null)}catch(w){console.warn(w)}}h=l[++a]}if(i>s){const S=l[c+1];let g=null;for(S&&(g=n.mirror.getNode(r.getId(S)));a<=c;++a){const w=st(l[a],n.mirror,r);try{e.insertBefore(w,g)}catch(N){console.warn(N)}}}else if(a>c)for(;i<=s;i++){const S=o[i];if(!(!S||S.parentNode!==e))try{e.removeChild(S),n.mirror.removeNodeFromMap(S)}catch(g){console.warn(g)}}let v=e.firstChild,f=t.firstChild;for(;v!==null&&f!==null;)ot(v,f,n,r),v=v.nextSibling,f=f.nextSibling}function st(e,t,n){const r=n.getId(e),o=n.getMeta(e);let l=null;if(r>-1&&(l=t.getNode(r)),l!==null&&xt(l,e))return l;switch(e.RRNodeType){case D.Document:l=new Document;break;case D.DocumentType:l=document.implementation.createDocumentType(e.name,e.publicId,e.systemId);break;case D.Element:{let i=e.tagName.toLowerCase();i=as[i]||i,o&&"isSVG"in o&&o?.isSVG?l=document.createElementNS(Ot.svg,i):l=document.createElement(e.tagName);break}case D.Text:l=document.createTextNode(e.data);break;case D.Comment:l=document.createComment(e.data);break;case D.CDATA:l=document.createCDATASection(e.data);break}o&&t.add(l,Object.assign({},o));try{ae?.add(l)}catch{}return l}function xt(e,t){return e.nodeType!==t.nodeType?!1:e.nodeType!==e.ELEMENT_NODE||e.tagName.toUpperCase()===t.tagName}function Re(e,t,n,r){const o=n.getId(e),l=r.getId(t);return o===-1||o!==l?!1:xt(e,t)}class Oe extends os(te){get unserializedId(){return this._unserializedId--}constructor(t){super(),this.UNSERIALIZED_STARTING_ID=-2,this._unserializedId=this.UNSERIALIZED_STARTING_ID,this.mirror=ws(),this.scrollData=null,t&&(this.mirror=t)}createDocument(t,n,r){return new Oe}createDocumentType(t,n,r){const o=new ds(t,n,r);return o.ownerDocument=this,o}createElement(t){const n=t.toUpperCase();let r;switch(n){case"AUDIO":case"VIDEO":r=new hs(n);break;case"IFRAME":r=new fs(n,this.mirror);break;case"CANVAS":r=new ps(n);break;case"STYLE":r=new ms(n);break;default:r=new ze(n);break}return r.ownerDocument=this,r}createComment(t){const n=new gs(t);return n.ownerDocument=this,n}createCDATASection(t){const n=new vs(t);return n.ownerDocument=this,n}createTextNode(t){const n=new ys(t);return n.ownerDocument=this,n}destroyTree(){this.firstChild=null,this.lastChild=null,this.mirror.reset()}open(){super.open(),this._unserializedId=this.UNSERIALIZED_STARTING_ID}}const ds=_n(te);class ze extends Fn(te){constructor(){super(...arguments),this.inputData=null,this.scrollData=null}}class hs extends ss(ze){}class ps extends ze{constructor(){super(...arguments),this.rr_dataURL=null,this.canvasMutations=[]}getContext(){return null}}class ms extends ze{constructor(){super(...arguments),this.rules=[]}}class fs extends ze{constructor(t,n){super(t),this.contentDocument=new Oe,this.contentDocument.mirror=n}}const ys=Pn(te),gs=$n(te),vs=Un(te);function Ss(e){return e instanceof HTMLFormElement?"FORM":e.tagName.toUpperCase()}function Vn(e,t,n,r){let o;switch(e.nodeType){case U.DOCUMENT_NODE:r&&r.nodeName==="IFRAME"?o=r.contentDocument:(o=t,o.compatMode=e.compatMode);break;case U.DOCUMENT_TYPE_NODE:{const i=e;o=t.createDocumentType(i.name,i.publicId,i.systemId);break}case U.ELEMENT_NODE:{const i=e,s=Ss(i);o=t.createElement(s);const a=o;for(const{name:c,value:u}of Array.from(i.attributes))a.attributes[c]=u;i.scrollLeft&&(a.scrollLeft=i.scrollLeft),i.scrollTop&&(a.scrollTop=i.scrollTop);break}case U.TEXT_NODE:o=t.createTextNode(e.textContent||"");break;case U.CDATA_SECTION_NODE:o=t.createCDATASection(e.data);break;case U.COMMENT_NODE:o=t.createComment(e.textContent||"");break;case U.DOCUMENT_FRAGMENT_NODE:o=r.attachShadow({mode:"open"});break;default:return null}let l=n.getMeta(e);return t instanceof Oe&&(l||(l=zn(o,t.unserializedId),n.add(e,l)),t.mirror.add(o,Object.assign({},l))),o}function bs(e,t=Ko(),n=new Oe){function r(o,l){const i=Vn(o,n,t,l);if(i!==null)if(l?.nodeName!=="IFRAME"&&o.nodeType!==U.DOCUMENT_FRAGMENT_NODE&&(l?.appendChild(i),i.parentNode=l,i.parentElement=l),o.nodeName==="IFRAME"){const s=o.contentDocument;s&&r(s,i)}else(o.nodeType===U.DOCUMENT_NODE||o.nodeType===U.ELEMENT_NODE||o.nodeType===U.DOCUMENT_FRAGMENT_NODE)&&(o.nodeType===U.ELEMENT_NODE&&o.shadowRoot&&r(o.shadowRoot,i),o.childNodes.forEach(s=>r(s,i)))}return r(e,null),n}function ws(){return new Es}class Es{constructor(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap}getId(t){var n;if(!t)return-1;const r=(n=this.getMeta(t))===null||n===void 0?void 0:n.id;return r??-1}getNode(t){return this.idNodeMap.get(t)||null}getIds(){return Array.from(this.idNodeMap.keys())}getMeta(t){return this.nodeMetaMap.get(t)||null}removeNodeFromMap(t){const n=this.getId(t);this.idNodeMap.delete(n),t.childNodes&&t.childNodes.forEach(r=>this.removeNodeFromMap(r))}has(t){return this.idNodeMap.has(t)}hasNode(t){return this.nodeMetaMap.has(t)}add(t,n){const r=n.id;this.idNodeMap.set(r,t),this.nodeMetaMap.set(t,n)}replace(t,n){const r=this.getNode(t);if(r){const o=this.nodeMetaMap.get(r);o&&this.nodeMetaMap.set(n,o)}this.idNodeMap.set(t,n)}reset(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap}}function zn(e,t){switch(e.RRNodeType){case D.Document:return{id:t,type:e.RRNodeType,childNodes:[]};case D.DocumentType:{const n=e;return{id:t,type:e.RRNodeType,name:n.name,publicId:n.publicId,systemId:n.systemId}}case D.Element:return{id:t,type:e.RRNodeType,tagName:e.tagName.toLowerCase(),attributes:{},childNodes:[]};case D.Text:return{id:t,type:e.RRNodeType,textContent:e.textContent||""};case D.Comment:return{id:t,type:e.RRNodeType,textContent:e.textContent||""};case D.CDATA:return{id:t,type:e.RRNodeType,textContent:""}}}function Hn(e){return{all:e=e||new Map,on:function(t,n){var r=e.get(t);r?r.push(n):e.set(t,[n])},off:function(t,n){var r=e.get(t);r&&(n?r.splice(r.indexOf(n)>>>0,1):e.set(t,[]))},emit:function(t,n){var r=e.get(t);r&&r.slice().map(function(o){o(n)}),(r=e.get("*"))&&r.slice().map(function(o){o(t,n)})}}}var Cs=Object.freeze({__proto__:null,default:Hn});function Ms(e=window,t=document){if("scrollBehavior"in t.documentElement.style&&e.__forceSmoothScrollPolyfill__!==!0)return;const n=e.HTMLElement||e.Element,r=468,o={scroll:e.scroll||e.scrollTo,scrollBy:e.scrollBy,elementScroll:n.prototype.scroll||a,scrollIntoView:n.prototype.scrollIntoView},l=e.performance&&e.performance.now?e.performance.now.bind(e.performance):Date.now;function i(f){const S=["MSIE ","Trident/","Edge/"];return new RegExp(S.join("|")).test(f)}const s=i(e.navigator.userAgent)?1:0;function a(f,S){this.scrollLeft=f,this.scrollTop=S}function c(f){return .5*(1-Math.cos(Math.PI*f))}function u(f){if(f===null||typeof f!="object"||f.behavior===void 0||f.behavior==="auto"||f.behavior==="instant")return!0;if(typeof f=="object"&&f.behavior==="smooth")return!1;throw new TypeError("behavior member of ScrollOptions "+f.behavior+" is not a valid value for enumeration ScrollBehavior.")}function d(f,S){if(S==="Y")return f.clientHeight+s<f.scrollHeight;if(S==="X")return f.clientWidth+s<f.scrollWidth}function h(f,S){const g=e.getComputedStyle(f,null)["overflow"+S];return g==="auto"||g==="scroll"}function m(f){const S=d(f,"Y")&&h(f,"Y"),g=d(f,"X")&&h(f,"X");return S||g}function y(f){for(;f!==t.body&&m(f)===!1;)f=f.parentNode||f.host;return f}function p(f){const S=l();let g,w,N,x=(S-f.startTime)/r;x=x>1?1:x,g=c(x),w=f.startX+(f.x-f.startX)*g,N=f.startY+(f.y-f.startY)*g,f.method.call(f.scrollable,w,N),(w!==f.x||N!==f.y)&&e.requestAnimationFrame(p.bind(e,f))}function v(f,S,g){let w,N,x,j;const V=l();f===t.body?(w=e,N=e.scrollX||e.pageXOffset,x=e.scrollY||e.pageYOffset,j=o.scroll):(w=f,N=f.scrollLeft,x=f.scrollTop,j=a),p({scrollable:w,method:j,startTime:V,startX:N,startY:x,x:S,y:g})}e.scroll=e.scrollTo=function(){if(arguments[0]!==void 0){if(u(arguments[0])===!0){o.scroll.call(e,arguments[0].left!==void 0?arguments[0].left:typeof arguments[0]!="object"?arguments[0]:e.scrollX||e.pageXOffset,arguments[0].top!==void 0?arguments[0].top:arguments[1]!==void 0?arguments[1]:e.scrollY||e.pageYOffset);return}v.call(e,t.body,arguments[0].left!==void 0?~~arguments[0].left:e.scrollX||e.pageXOffset,arguments[0].top!==void 0?~~arguments[0].top:e.scrollY||e.pageYOffset)}},e.scrollBy=function(){if(arguments[0]!==void 0){if(u(arguments[0])){o.scrollBy.call(e,arguments[0].left!==void 0?arguments[0].left:typeof arguments[0]!="object"?arguments[0]:0,arguments[0].top!==void 0?arguments[0].top:arguments[1]!==void 0?arguments[1]:0);return}v.call(e,t.body,~~arguments[0].left+(e.scrollX||e.pageXOffset),~~arguments[0].top+(e.scrollY||e.pageYOffset))}},n.prototype.scroll=n.prototype.scrollTo=function(){if(arguments[0]===void 0)return;if(u(arguments[0])===!0){if(typeof arguments[0]=="number"&&arguments[1]===void 0)throw new SyntaxError("Value could not be converted");o.elementScroll.call(this,arguments[0].left!==void 0?~~arguments[0].left:typeof arguments[0]!="object"?~~arguments[0]:this.scrollLeft,arguments[0].top!==void 0?~~arguments[0].top:arguments[1]!==void 0?~~arguments[1]:this.scrollTop);return}const f=arguments[0].left,S=arguments[0].top;v.call(this,this,typeof f>"u"?this.scrollLeft:~~f,typeof S>"u"?this.scrollTop:~~S)},n.prototype.scrollBy=function(){if(arguments[0]!==void 0){if(u(arguments[0])===!0){o.elementScroll.call(this,arguments[0].left!==void 0?~~arguments[0].left+this.scrollLeft:~~arguments[0]+this.scrollLeft,arguments[0].top!==void 0?~~arguments[0].top+this.scrollTop:~~arguments[1]+this.scrollTop);return}this.scroll({left:~~arguments[0].left+this.scrollLeft,top:~~arguments[0].top+this.scrollTop,behavior:arguments[0].behavior})}},n.prototype.scrollIntoView=function(){if(u(arguments[0])===!0){o.scrollIntoView.call(this,arguments[0]===void 0?!0:arguments[0]);return}const f=y(this),S=f.getBoundingClientRect(),g=this.getBoundingClientRect();f!==t.body?(v.call(this,f,f.scrollLeft+g.left-S.left,f.scrollTop+g.top-S.top),e.getComputedStyle(f).position!=="fixed"&&e.scrollBy({left:S.left,top:S.top,behavior:"smooth"})):e.scrollBy({left:g.left,top:g.top,behavior:"smooth"})}}class Ts{constructor(t=[],n){this.timeOffset=0,this.raf=null,this.actions=t,this.speed=n.speed}addAction(t){const n=this.raf===!0;if(!this.actions.length||this.actions[this.actions.length-1].delay<=t.delay)this.actions.push(t);else{const r=this.findActionIndex(t);this.actions.splice(r,0,t)}n&&(this.raf=requestAnimationFrame(this.rafCheck.bind(this)))}start(){this.timeOffset=0,this.lastTimestamp=performance.now(),this.raf=requestAnimationFrame(this.rafCheck.bind(this))}rafCheck(){const t=performance.now();for(this.timeOffset+=(t-this.lastTimestamp)*this.speed,this.lastTimestamp=t;this.actions.length;){const n=this.actions[0];if(this.timeOffset>=n.delay)this.actions.shift(),n.doAction();else break}this.actions.length>0?this.raf=requestAnimationFrame(this.rafCheck.bind(this)):this.raf=!0}clear(){this.raf&&(this.raf!==!0&&cancelAnimationFrame(this.raf),this.raf=null),this.actions.length=0}setSpeed(t){this.speed=t}isActive(){return this.raf!==null}findActionIndex(t){let n=0,r=this.actions.length-1;for(;n<=r;){const o=Math.floor((n+r)/2);if(this.actions[o].delay<t.delay)n=o+1;else if(this.actions[o].delay>t.delay)r=o-1;else return o+1}return n}}function Gn(e,t){if(e.type===M.IncrementalSnapshot&&e.data.source===E.MouseMove&&e.data.positions&&e.data.positions.length){const n=e.data.positions[0].timeOffset,r=e.timestamp+n;return e.delay=r-t,r-t}return e.delay=e.timestamp-t,e.delay}/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function Yn(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r,o,l=n.call(e),i=[];try{for(;(t===void 0||t-- >0)&&!(r=l.next()).done;)i.push(r.value)}catch(s){o={error:s}}finally{try{r&&!r.done&&(n=l.return)&&n.call(l)}finally{if(o)throw o.error}}return i}var xe;(function(e){e[e.NotStarted=0]="NotStarted",e[e.Running=1]="Running",e[e.Stopped=2]="Stopped"})(xe||(xe={}));var Xn={type:"xstate.init"};function At(e){return e===void 0?[]:[].concat(e)}function Ae(e){return{type:"xstate.assign",assignment:e}}function qn(e,t){return typeof(e=typeof e=="string"&&t&&t[e]?t[e]:e)=="string"?{type:e}:typeof e=="function"?{type:e.name,exec:e}:e}function it(e){return function(t){return e===t}}function Qn(e){return typeof e=="string"?{type:e}:e}function Jn(e,t){return{value:e,context:t,actions:[],changed:!1,matches:it(e)}}function Kn(e,t,n){var r=t,o=!1;return[e.filter(function(l){if(l.type==="xstate.assign"){o=!0;var i=Object.assign({},r);return typeof l.assignment=="function"?i=l.assignment(r,n):Object.keys(l.assignment).forEach(function(s){i[s]=typeof l.assignment[s]=="function"?l.assignment[s](r,n):l.assignment[s]}),r=i,!1}return!0}),r,o]}function Zn(e,t){t===void 0&&(t={});var n=Yn(Kn(At(e.states[e.initial].entry).map(function(i){return qn(i,t.actions)}),e.context,Xn),2),r=n[0],o=n[1],l={config:e,_options:t,initialState:{value:e.initial,actions:r,context:o,matches:it(e.initial)},transition:function(i,s){var a,c,u=typeof i=="string"?{value:i,context:e.context}:i,d=u.value,h=u.context,m=Qn(s),y=e.states[d];if(y.on){var p=At(y.on[m.type]);try{for(var v=function(P){var he=typeof Symbol=="function"&&Symbol.iterator,C=he&&P[he],b=0;if(C)return C.call(P);if(P&&typeof P.length=="number")return{next:function(){return P&&b>=P.length&&(P=void 0),{value:P&&P[b++],done:!P}}};throw new TypeError(he?"Object is not iterable.":"Symbol.iterator is not defined.")}(p),f=v.next();!f.done;f=v.next()){var S=f.value;if(S===void 0)return Jn(d,h);var g=typeof S=="string"?{target:S}:S,w=g.target,N=g.actions,x=N===void 0?[]:N,j=g.cond,V=j===void 0?function(){return!0}:j,Q=w===void 0,J=w??d,ne=e.states[J];if(V(h,m)){var A=Yn(Kn((Q?At(x):[].concat(y.exit,x,ne.entry).filter(function(P){return P})).map(function(P){return qn(P,l._options.actions)}),h,m),3),re=A[0],H=A[1],oe=A[2],G=w??d;return{value:G,context:H,actions:re,changed:w!==d||re.length>0||oe,matches:it(G)}}}}catch(P){a={error:P}}finally{try{f&&!f.done&&(c=v.return)&&c.call(v)}finally{if(a)throw a.error}}}return Jn(d,h)}};return l}var er=function(e,t){return e.actions.forEach(function(n){var r=n.exec;return r&&r(e.context,t)})};function tr(e){var t=e.initialState,n=xe.NotStarted,r=new Set,o={_machine:e,send:function(l){n===xe.Running&&(t=e.transition(t,l),er(t,Qn(l)),r.forEach(function(i){return i(t)}))},subscribe:function(l){return r.add(l),l(t),{unsubscribe:function(){return r.delete(l)}}},start:function(l){if(l){var i=typeof l=="object"?l:{context:e.config.context,value:l};t={value:i.value,actions:[],context:i.context,matches:it(i.value)}}return n=xe.Running,er(t,Xn),o},stop:function(){return n=xe.Stopped,r.clear(),o},get state(){return t},get status(){return n}};return o}var Ns=Object.defineProperty,Is=Object.defineProperties,Ds=Object.getOwnPropertyDescriptors,nr=Object.getOwnPropertySymbols,ks=Object.prototype.hasOwnProperty,Rs=Object.prototype.propertyIsEnumerable,rr=(e,t,n)=>t in e?Ns(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Lt=(e,t)=>{for(var n in t||(t={}))ks.call(t,n)&&rr(e,n,t[n]);if(nr)for(var n of nr(t))Rs.call(t,n)&&rr(e,n,t[n]);return e},_t=(e,t)=>Is(e,Ds(t));function Os(e,t){for(let n=e.length-1;n>=0;n--){const r=e[n];if(r.type===M.Meta&&r.timestamp<=t)return e.slice(n)}return e}function xs(e,{getCastFn:t,applyEventsSynchronously:n,emitter:r}){const o=Zn({id:"player",context:e,initial:"paused",states:{playing:{on:{PAUSE:{target:"paused",actions:["pause"]},CAST_EVENT:{target:"playing",actions:"castEvent"},END:{target:"paused",actions:["resetLastPlayedEvent","pause"]},ADD_EVENT:{target:"playing",actions:["addEvent"]}}},paused:{on:{PLAY:{target:"playing",actions:["recordTimeOffset","play"]},CAST_EVENT:{target:"paused",actions:"castEvent"},TO_LIVE:{target:"live",actions:["startLive"]},ADD_EVENT:{target:"paused",actions:["addEvent"]}}},live:{on:{ADD_EVENT:{target:"live",actions:["addEvent"]},CAST_EVENT:{target:"live",actions:["castEvent"]}}}}},{actions:{castEvent:Ae({lastPlayedEvent:(l,i)=>i.type==="CAST_EVENT"?i.payload.event:l.lastPlayedEvent}),recordTimeOffset:Ae((l,i)=>{let s=l.timeOffset;return"payload"in i&&"timeOffset"in i.payload&&(s=i.payload.timeOffset),_t(Lt({},l),{timeOffset:s,baselineTime:l.events[0].timestamp+s})}),play(l){var i;const{timer:s,events:a,baselineTime:c,lastPlayedEvent:u}=l;s.clear();for(const y of a)Gn(y,c);const d=Os(a,c);let h=u?.timestamp;u?.type===M.IncrementalSnapshot&&u.data.source===E.MouseMove&&(h=u.timestamp+((i=u.data.positions[0])==null?void 0:i.timeOffset)),c<(h||0)&&r.emit(L.PlayBack);const m=new Array;for(const y of d)if(!(h&&h<c&&(y.timestamp<=h||y===u)))if(y.timestamp<c)m.push(y);else{const p=t(y,!1);s.addAction({doAction:()=>{p()},delay:y.delay})}n(m),r.emit(L.Flush),s.start()},pause(l){l.timer.clear()},resetLastPlayedEvent:Ae(l=>_t(Lt({},l),{lastPlayedEvent:null})),startLive:Ae({baselineTime:(l,i)=>(l.timer.start(),i.type==="TO_LIVE"&&i.payload.baselineTime?i.payload.baselineTime:Date.now())}),addEvent:Ae((l,i)=>{const{baselineTime:s,timer:a,events:c}=l;if(i.type==="ADD_EVENT"){const{event:u}=i.payload;Gn(u,s);let d=c.length-1;if(!c[d]||c[d].timestamp<=u.timestamp)c.push(u);else{let y=-1,p=0;for(;p<=d;){const v=Math.floor((p+d)/2);c[v].timestamp<=u.timestamp?p=v+1:d=v-1}y===-1&&(y=p),c.splice(y,0,u)}const h=u.timestamp<s,m=t(u,h);h?m():a.isActive()&&a.addAction({doAction:()=>{m()},delay:u.delay})}return _t(Lt({},l),{events:c})})}});return tr(o)}function As(e){const t=Zn({id:"speed",context:e,initial:"normal",states:{normal:{on:{FAST_FORWARD:{target:"skipping",actions:["recordSpeed","setSpeed"]},SET_SPEED:{target:"normal",actions:["setSpeed"]}}},skipping:{on:{BACK_TO_NORMAL:{target:"normal",actions:["restoreSpeed"]},SET_SPEED:{target:"normal",actions:["setSpeed"]}}}}},{actions:{setSpeed:(n,r)=>{"payload"in r&&n.timer.setSpeed(r.payload.speed)},recordSpeed:Ae({normalSpeed:n=>n.timer.speed}),restoreSpeed:n=>{n.timer.setSpeed(n.normalSpeed)}}});return tr(t)}const Ls=e=>[`.${e} { background: currentColor }`,"noscript { display: none !important; }"];var _s=(e,t,n)=>new Promise((r,o)=>{var l=a=>{try{s(n.next(a))}catch(c){o(c)}},i=a=>{try{s(n.throw(a))}catch(c){o(c)}},s=a=>a.done?r(a.value):Promise.resolve(a.value).then(l,i);s((n=n.apply(e,t)).next())});const or=new Map;function sr(e,t){let n=or.get(e);return n||(n=new Map,or.set(e,n)),n.has(t)||n.set(t,[]),n.get(t)}function ye(e,t,n){return r=>_s(this,null,function*(){if(r&&typeof r=="object"&&"rr_type"in r)if(n&&(n.isUnchanged=!1),r.rr_type==="ImageBitmap"&&"args"in r){const o=yield ye(e,t,n)(r.args);return yield createImageBitmap.apply(null,o)}else if("index"in r){if(n||t===null)return r;const{rr_type:o,index:l}=r;return sr(t,o)[l]}else if("args"in r){const{rr_type:o,args:l}=r,i=window[o];return new i(...yield Promise.all(l.map(ye(e,t,n))))}else{if("base64"in r)return ko(r.base64);if("src"in r){const o=e.get(r.src);if(o)return o;{const l=new Image;return l.src=r.src,e.set(r.src,l),l}}else if("data"in r&&r.rr_type==="Blob"){const o=yield Promise.all(r.data.map(ye(e,t,n)));return new Blob(o,{type:r.type})}}else if(Array.isArray(r))return yield Promise.all(r.map(ye(e,t,n)));return r})}var Fs=(e,t,n)=>new Promise((r,o)=>{var l=a=>{try{s(n.next(a))}catch(c){o(c)}},i=a=>{try{s(n.throw(a))}catch(c){o(c)}},s=a=>a.done?r(a.value):Promise.resolve(a.value).then(l,i);s((n=n.apply(e,t)).next())});function Ps(e,t){try{return t===ue.WebGL?e.getContext("webgl")||e.getContext("experimental-webgl"):e.getContext("webgl2")}catch{return null}}const $s=["WebGLActiveInfo","WebGLBuffer","WebGLFramebuffer","WebGLProgram","WebGLRenderbuffer","WebGLShader","WebGLShaderPrecisionFormat","WebGLTexture","WebGLUniformLocation","WebGLVertexArrayObject"];function Us(e,t){if(!(t!=null&&t.constructor))return;const{name:n}=t.constructor;if(!$s.includes(n))return;const r=sr(e,n);r.includes(t)||r.push(t)}function Ws(e){return Fs(this,arguments,function*({mutation:t,target:n,type:r,imageMap:o,errorHandler:l}){try{const i=Ps(n,r);if(!i)return;if(t.setter){i[t.property]=t.args[0];return}const s=i[t.property],a=yield Promise.all(t.args.map(ye(o,i))),c=s.apply(i,a);Us(i,c)}catch(i){l(t,i)}})}var ir=(e,t,n)=>new Promise((r,o)=>{var l=a=>{try{s(n.next(a))}catch(c){o(c)}},i=a=>{try{s(n.throw(a))}catch(c){o(c)}},s=a=>a.done?r(a.value):Promise.resolve(a.value).then(l,i);s((n=n.apply(e,t)).next())});function Bs(e){return ir(this,arguments,function*({event:t,mutations:n,target:r,imageMap:o,errorHandler:l}){const i=r.getContext("2d");if(!i){l(n[0],new Error("Canvas context is null"));return}const s=n.map(a=>ir(this,null,function*(){return Promise.all(a.args.map(ye(o,i)))}));(yield Promise.all(s)).forEach((a,c)=>{const u=n[c];try{if(u.setter){i[u.property]=u.args[0];return}const d=i[u.property];u.property==="drawImage"&&typeof u.args[0]=="string"?(o.get(t),d.apply(i,u.args)):d.apply(i,a)}catch(d){l(u,d)}})})}var js=(e,t,n)=>new Promise((r,o)=>{var l=a=>{try{s(n.next(a))}catch(c){o(c)}},i=a=>{try{s(n.throw(a))}catch(c){o(c)}},s=a=>a.done?r(a.value):Promise.resolve(a.value).then(l,i);s((n=n.apply(e,t)).next())});function ar(e){return js(this,arguments,function*({event:t,mutation:n,target:r,imageMap:o,canvasEventMap:l,errorHandler:i}){try{const s=l.get(t)||n,a="commands"in s?s.commands:[s];if([ue.WebGL,ue.WebGL2].includes(n.type)){for(let c=0;c<a.length;c++){const u=a[c];yield Ws({mutation:u,type:n.type,target:r,imageMap:o,errorHandler:i})}return}yield Bs({event:t,mutations:a,target:r,imageMap:o,errorHandler:i})}catch(s){i(n,s)}})}var Vs=Object.defineProperty,zs=Object.defineProperties,Hs=Object.getOwnPropertyDescriptors,lr=Object.getOwnPropertySymbols,Gs=Object.prototype.hasOwnProperty,Ys=Object.prototype.propertyIsEnumerable,cr=(e,t,n)=>t in e?Vs(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,at=(e,t)=>{for(var n in t||(t={}))Gs.call(t,n)&&cr(e,n,t[n]);if(lr)for(var n of lr(t))Ys.call(t,n)&&cr(e,n,t[n]);return e},Ft=(e,t)=>zs(e,Hs(t)),Pt=(e,t,n)=>new Promise((r,o)=>{var l=a=>{try{s(n.next(a))}catch(c){o(c)}},i=a=>{try{s(n.throw(a))}catch(c){o(c)}},s=a=>a.done?r(a.value):Promise.resolve(a.value).then(l,i);s((n=n.apply(e,t)).next())});const Xs=10*1e3,qs=5*1e3,Qs=Hn||Cs,ur="[replayer]",$t={duration:500,lineCap:"round",lineWidth:3,strokeStyle:"red"};function dr(e){return e.type==M.IncrementalSnapshot&&(e.data.source==E.TouchMove||e.data.source==E.MouseInteraction&&e.data.type==O.TouchStart)}class Js{constructor(t,n){if(this.usingVirtualDom=!1,this.virtualDom=new Oe,this.mouseTail=null,this.tailPositions=[],this.emitter=Qs(),this.legacy_missingNodeRetryMap={},this.cache=en(),this.imageMap=new Map,this.canvasEventMap=new Map,this.mirror=Vt(),this.styleMirror=new Mt,this.firstFullSnapshot=null,this.newDocumentQueue=[],this.mousePos=null,this.touchActive=null,this.lastMouseDownEvent=null,this.lastSelectionData=null,this.constructedStyleMutations=[],this.adoptedStyleSheets=[],this.handleResize=s=>{this.iframe.style.display="inherit";for(const a of[this.mouseTail,this.iframe])!a||(a.setAttribute("width",String(s.width)),a.setAttribute("height",String(s.height)))},this.applyEventsSynchronously=s=>{for(const a of s){switch(a.type){case M.DomContentLoaded:case M.Load:case M.Custom:continue;case M.FullSnapshot:case M.Meta:case M.Plugin:case M.IncrementalSnapshot:break}this.getCastFn(a,!0)()}},this.getCastFn=(s,a=!1)=>{let c;switch(s.type){case M.DomContentLoaded:case M.Load:break;case M.Custom:c=()=>{this.emitter.emit(L.CustomEvent,s)};break;case M.Meta:c=()=>this.emitter.emit(L.Resize,{width:s.data.width,height:s.data.height});break;case M.FullSnapshot:c=()=>{var u;if(this.firstFullSnapshot){if(this.firstFullSnapshot===s){this.firstFullSnapshot=!0;return}}else this.firstFullSnapshot=!0;this.rebuildFullSnapshot(s,a),(u=this.iframe.contentWindow)==null||u.scrollTo(s.data.initialOffset),this.styleMirror.reset()};break;case M.IncrementalSnapshot:c=()=>{if(this.applyIncremental(s,a),!a&&(s===this.nextUserInteractionEvent&&(this.nextUserInteractionEvent=null,this.backToNormal()),this.config.skipInactive&&!this.nextUserInteractionEvent)){for(const u of this.service.state.context.events)if(!(u.timestamp<=s.timestamp)&&this.isUserInteraction(u)){u.delay-s.delay>Xs*this.speedService.state.context.timer.speed&&(this.nextUserInteractionEvent=u);break}if(this.nextUserInteractionEvent){const u=this.nextUserInteractionEvent.delay-s.delay,d={speed:Math.min(Math.round(u/qs),this.config.maxSpeed)};this.speedService.send({type:"FAST_FORWARD",payload:d}),this.emitter.emit(L.SkipStart,d)}}};break}return()=>{c&&c();for(const d of this.config.plugins||[])d.handler&&d.handler(s,a,{replayer:this});this.service.send({type:"CAST_EVENT",payload:{event:s}});const u=this.service.state.context.events.length-1;if(!this.config.liveMode&&s===this.service.state.context.events[u]){const d=()=>{u<this.service.state.context.events.length-1||(this.backToNormal(),this.service.send("END"),this.emitter.emit(L.Finish))};let h=50;s.type===M.IncrementalSnapshot&&s.data.source===E.MouseMove&&s.data.positions.length&&(h+=Math.max(0,-s.data.positions[0].timeOffset)),setTimeout(d,h)}this.emitter.emit(L.EventCast,s)}},!(n!=null&&n.liveMode)&&t.length<2)throw new Error("Replayer need at least 2 events.");const r={speed:1,maxSpeed:360,root:document.body,loadTimeout:0,skipInactive:!1,showWarning:!0,showDebug:!1,blockClass:"rr-block",liveMode:!1,insertStyleRules:[],triggerFocus:!0,UNSAFE_replayCanvas:!1,pauseAnimation:!0,mouseTail:$t,useVirtualDom:!0,logger:console};this.config=Object.assign({},r,n),this.handleResize=this.handleResize.bind(this),this.getCastFn=this.getCastFn.bind(this),this.applyEventsSynchronously=this.applyEventsSynchronously.bind(this),this.emitter.on(L.Resize,this.handleResize),this.setupDom();for(const s of this.config.plugins||[])s.getMirror&&s.getMirror({nodeMirror:this.mirror});this.emitter.on(L.Flush,()=>{if(this.usingVirtualDom){const s={mirror:this.mirror,applyCanvas:(a,c,u)=>{ar({event:a,mutation:c,target:u,imageMap:this.imageMap,canvasEventMap:this.canvasEventMap,errorHandler:this.warnCanvasMutationFailed.bind(this)})},applyInput:this.applyInput.bind(this),applyScroll:this.applyScroll.bind(this),applyStyleSheetMutation:(a,c)=>{a.source===E.StyleSheetRule?this.applyStyleSheetRule(a,c):a.source===E.StyleDeclaration&&this.applyStyleDeclaration(a,c)},afterAppend:(a,c)=>{for(const u of this.config.plugins||[])u.onBuild&&u.onBuild(a,{id:c,replayer:this})}};if(this.iframe.contentDocument)try{ot(this.iframe.contentDocument,this.virtualDom,s,this.virtualDom.mirror)}catch(a){console.warn(a)}if(this.virtualDom.destroyTree(),this.usingVirtualDom=!1,Object.keys(this.legacy_missingNodeRetryMap).length)for(const a in this.legacy_missingNodeRetryMap)try{const c=this.legacy_missingNodeRetryMap[a],u=st(c.node,this.mirror,this.virtualDom.mirror);ot(u,c.node,s,this.virtualDom.mirror),c.node=u}catch(c){this.warn(c)}this.constructedStyleMutations.forEach(a=>{this.applyStyleSheetMutation(a)}),this.constructedStyleMutations=[],this.adoptedStyleSheets.forEach(a=>{this.applyAdoptedStyleSheet(a)}),this.adoptedStyleSheets=[]}if(this.mousePos&&(this.moveAndHover(this.mousePos.x,this.mousePos.y,this.mousePos.id,!0,this.mousePos.debugData),this.mousePos=null),this.touchActive===!0?this.mouse.classList.add("touch-active"):this.touchActive===!1&&this.mouse.classList.remove("touch-active"),this.touchActive=null,this.lastMouseDownEvent){const[s,a]=this.lastMouseDownEvent;s.dispatchEvent(a)}this.lastMouseDownEvent=null,this.lastSelectionData&&(this.applySelection(this.lastSelectionData),this.lastSelectionData=null)}),this.emitter.on(L.PlayBack,()=>{this.firstFullSnapshot=null,this.mirror.reset(),this.styleMirror.reset()});const o=new Ts([],{speed:this.config.speed});this.service=xs({events:t.map(s=>n&&n.unpackFn?n.unpackFn(s):s).sort((s,a)=>s.timestamp-a.timestamp),timer:o,timeOffset:0,baselineTime:0,lastPlayedEvent:null},{getCastFn:this.getCastFn,applyEventsSynchronously:this.applyEventsSynchronously,emitter:this.emitter}),this.service.start(),this.service.subscribe(s=>{this.emitter.emit(L.StateChange,{player:s})}),this.speedService=As({normalSpeed:-1,timer:o}),this.speedService.start(),this.speedService.subscribe(s=>{this.emitter.emit(L.StateChange,{speed:s})});const l=this.service.state.context.events.find(s=>s.type===M.Meta),i=this.service.state.context.events.find(s=>s.type===M.FullSnapshot);if(l){const{width:s,height:a}=l.data;setTimeout(()=>{this.emitter.emit(L.Resize,{width:s,height:a})},0)}i&&setTimeout(()=>{var s;this.firstFullSnapshot||(this.firstFullSnapshot=i,this.rebuildFullSnapshot(i),(s=this.iframe.contentWindow)==null||s.scrollTo(i.data.initialOffset))},1),this.service.state.context.events.find(dr)&&this.mouse.classList.add("touch-device")}get timer(){return this.service.state.context.timer}on(t,n){return this.emitter.on(t,n),this}off(t,n){return this.emitter.off(t,n),this}setConfig(t){Object.keys(t).forEach(n=>{t[n],this.config[n]=t[n]}),this.config.skipInactive||this.backToNormal(),typeof t.speed<"u"&&this.speedService.send({type:"SET_SPEED",payload:{speed:t.speed}}),typeof t.mouseTail<"u"&&(t.mouseTail===!1?this.mouseTail&&(this.mouseTail.style.display="none"):(this.mouseTail||(this.mouseTail=document.createElement("canvas"),this.mouseTail.width=Number.parseFloat(this.iframe.width),this.mouseTail.height=Number.parseFloat(this.iframe.height),this.mouseTail.classList.add("replayer-mouse-tail"),this.wrapper.insertBefore(this.mouseTail,this.iframe)),this.mouseTail.style.display="inherit"))}getMetaData(){const t=this.service.state.context.events[0],n=this.service.state.context.events[this.service.state.context.events.length-1];return{startTime:t.timestamp,endTime:n.timestamp,totalTime:n.timestamp-t.timestamp}}getCurrentTime(){return this.timer.timeOffset+this.getTimeOffset()}getTimeOffset(){const{baselineTime:t,events:n}=this.service.state.context;return t-n[0].timestamp}getMirror(){return this.mirror}play(t=0){var n,r;this.service.state.matches("paused")?this.service.send({type:"PLAY",payload:{timeOffset:t}}):(this.service.send({type:"PAUSE"}),this.service.send({type:"PLAY",payload:{timeOffset:t}})),(r=(n=this.iframe.contentDocument)==null?void 0:n.getElementsByTagName("html")[0])==null||r.classList.remove("fpweb-paused"),this.emitter.emit(L.Start)}pause(t){var n,r;t===void 0&&this.service.state.matches("playing")&&this.service.send({type:"PAUSE"}),typeof t=="number"&&(this.play(t),this.service.send({type:"PAUSE"})),(r=(n=this.iframe.contentDocument)==null?void 0:n.getElementsByTagName("html")[0])==null||r.classList.add("fpweb-paused"),this.emitter.emit(L.Pause)}resume(t=0){this.warn("The 'resume' was deprecated in 1.0. Please use 'play' method which has the same interface."),this.play(t),this.emitter.emit(L.Resume)}destroy(){this.pause(),this.config.root.removeChild(this.wrapper),this.emitter.emit(L.Destroy)}startLive(t){this.service.send({type:"TO_LIVE",payload:{baselineTime:t}})}addEvent(t){const n=this.config.unpackFn?this.config.unpackFn(t):t;dr(n)&&this.mouse.classList.add("touch-device"),Promise.resolve().then(()=>this.service.send({type:"ADD_EVENT",payload:{event:n}}))}enableInteract(){this.iframe.setAttribute("scrolling","auto"),this.iframe.style.pointerEvents="auto"}disableInteract(){this.iframe.setAttribute("scrolling","no"),this.iframe.style.pointerEvents="none"}resetCache(){this.cache=en()}setupDom(){this.wrapper=document.createElement("div"),this.wrapper.classList.add("replayer-wrapper"),this.config.root.appendChild(this.wrapper),this.mouse=document.createElement("div"),this.mouse.classList.add("replayer-mouse"),this.wrapper.appendChild(this.mouse),this.config.mouseTail!==!1&&(this.mouseTail=document.createElement("canvas"),this.mouseTail.classList.add("replayer-mouse-tail"),this.mouseTail.style.display="inherit",this.wrapper.appendChild(this.mouseTail)),this.iframe=document.createElement("iframe");const t=["allow-same-origin"];this.config.UNSAFE_replayCanvas&&t.push("allow-scripts"),this.iframe.style.display="none",this.iframe.setAttribute("sandbox",t.join(" ")),this.disableInteract(),this.wrapper.appendChild(this.iframe),this.iframe.contentWindow&&this.iframe.contentDocument&&(Ms(this.iframe.contentWindow,this.iframe.contentDocument),St(this.iframe.contentWindow))}rebuildFullSnapshot(t,n=!1){if(!this.iframe.contentDocument)return this.warn("Looks like your replayer has been destroyed.");Object.keys(this.legacy_missingNodeRetryMap).length&&this.warn("Found unresolved missing node map",this.legacy_missingNodeRetryMap),this.legacy_missingNodeRetryMap={};const r=[],o=(s,a)=>{this.collectIframeAndAttachDocument(r,s);for(const c of this.config.plugins||[])c.onBuild&&c.onBuild(s,{id:a,replayer:this})};this.usingVirtualDom&&(this.virtualDom.destroyTree(),this.usingVirtualDom=!1),this.mirror.reset(),qr(t.data.node,{doc:this.iframe.contentDocument,afterAppend:o,cache:this.cache,mirror:this.mirror}),o(this.iframe.contentDocument,t.data.node.id);for(const{mutationInQueue:s,builtNode:a}of r)this.attachDocumentToIframe(s,a),this.newDocumentQueue=this.newDocumentQueue.filter(c=>c!==s);const{documentElement:l,head:i}=this.iframe.contentDocument;this.insertStyleRules(l,i),this.service.state.matches("playing")||this.iframe.contentDocument.getElementsByTagName("html")[0].classList.add("fpweb-paused"),this.emitter.emit(L.FullsnapshotRebuilded,t),n||this.waitForStylesheetLoad(),this.config.UNSAFE_replayCanvas&&this.preloadAllImages()}insertStyleRules(t,n){var r;const o=Ls(this.config.blockClass).concat(this.config.insertStyleRules);if(this.config.pauseAnimation&&o.push("html.fpweb-paused *, html.fpweb-paused *:before, html.fpweb-paused *:after { animation-play-state: paused !important; }"),this.usingVirtualDom){const l=this.virtualDom.createElement("style");this.virtualDom.mirror.add(l,zn(l,this.virtualDom.unserializedId)),t.insertBefore(l,n),l.rules.push({source:E.StyleSheetRule,adds:o.map((i,s)=>({rule:i,index:s}))})}else{const l=document.createElement("style");t.insertBefore(l,n);for(let i=0;i<o.length;i++)(r=l.sheet)==null||r.insertRule(o[i],i)}}attachDocumentToIframe(t,n){const r=this.usingVirtualDom?this.virtualDom.mirror:this.mirror,o=[],l=(i,s)=>{this.collectIframeAndAttachDocument(o,i);const a=r.getMeta(i);if(a?.type===T.Element&&a?.tagName.toUpperCase()==="HTML"){const{documentElement:c,head:u}=n.contentDocument;this.insertStyleRules(c,u)}if(!this.usingVirtualDom)for(const c of this.config.plugins||[])c.onBuild&&c.onBuild(i,{id:s,replayer:this})};$e(t.node,{doc:n.contentDocument,mirror:r,hackCss:!0,skipChild:!1,afterAppend:l,cache:this.cache}),l(n.contentDocument,t.node.id);for(const{mutationInQueue:i,builtNode:s}of o)this.attachDocumentToIframe(i,s),this.newDocumentQueue=this.newDocumentQueue.filter(a=>a!==i)}collectIframeAndAttachDocument(t,n){if(Ie(n,this.mirror)){const r=this.newDocumentQueue.find(o=>o.parentId===this.mirror.getId(n));r&&t.push({mutationInQueue:r,builtNode:n})}}waitForStylesheetLoad(){var t;const n=(t=this.iframe.contentDocument)==null?void 0:t.head;if(n){const r=new Set;let o,l=this.service.state;const i=()=>{l=this.service.state};this.emitter.on(L.Start,i),this.emitter.on(L.Pause,i);const s=()=>{this.emitter.off(L.Start,i),this.emitter.off(L.Pause,i)};n.querySelectorAll('link[rel="stylesheet"]').forEach(a=>{a.sheet||(r.add(a),a.addEventListener("load",()=>{r.delete(a),r.size===0&&o!==-1&&(l.matches("playing")&&this.play(this.getCurrentTime()),this.emitter.emit(L.LoadStylesheetEnd),o&&clearTimeout(o),s())}))}),r.size>0&&(this.service.send({type:"PAUSE"}),this.emitter.emit(L.LoadStylesheetStart),o=setTimeout(()=>{l.matches("playing")&&this.play(this.getCurrentTime()),o=-1,s()},this.config.loadTimeout))}}preloadAllImages(){return Pt(this,null,function*(){this.service.state;const t=()=>{this.service.state};this.emitter.on(L.Start,t),this.emitter.on(L.Pause,t);const n=[];for(const r of this.service.state.context.events)r.type===M.IncrementalSnapshot&&r.data.source===E.CanvasMutation&&(n.push(this.deserializeAndPreloadCanvasEvents(r.data,r)),("commands"in r.data?r.data.commands:[r.data]).forEach(o=>{this.preloadImages(o,r)}));return Promise.all(n)})}preloadImages(t,n){if(t.property==="drawImage"&&typeof t.args[0]=="string"&&!this.imageMap.has(n)){const r=document.createElement("canvas"),o=r.getContext("2d"),l=o?.createImageData(r.width,r.height);l?.data,JSON.parse(t.args[0]),o?.putImageData(l,0,0)}}deserializeAndPreloadCanvasEvents(t,n){return Pt(this,null,function*(){if(!this.canvasEventMap.has(n)){const r={isUnchanged:!0};if("commands"in t){const o=yield Promise.all(t.commands.map(l=>Pt(this,null,function*(){const i=yield Promise.all(l.args.map(ye(this.imageMap,null,r)));return Ft(at({},l),{args:i})})));r.isUnchanged===!1&&this.canvasEventMap.set(n,Ft(at({},t),{commands:o}))}else{const o=yield Promise.all(t.args.map(ye(this.imageMap,null,r)));r.isUnchanged===!1&&this.canvasEventMap.set(n,Ft(at({},t),{args:o}))}}})}applyIncremental(t,n){var r,o,l;const{data:i}=t;switch(i.source){case E.Mutation:{try{this.applyMutation(i,n)}catch(s){this.warn(`Exception in mutation ${s.message||s}`,i)}break}case E.Drag:case E.TouchMove:case E.MouseMove:if(n){const s=i.positions[i.positions.length-1];this.mousePos={x:s.x,y:s.y,id:s.id,debugData:i}}else i.positions.forEach(s=>{const a={doAction:()=>{this.moveAndHover(s.x,s.y,s.id,n,i)},delay:s.timeOffset+t.timestamp-this.service.state.context.baselineTime};this.timer.addAction(a)}),this.timer.addAction({doAction(){},delay:t.delay-((r=i.positions[0])==null?void 0:r.timeOffset)});break;case E.MouseInteraction:{if(i.id===-1)break;const s=new Event(pe(O[i.type])),a=this.mirror.getNode(i.id);if(!a)return this.debugNodeNotFound(i,i.id);this.emitter.emit(L.MouseInteraction,{type:i.type,target:a});const{triggerFocus:c}=this.config;switch(i.type){case O.Blur:"blur"in a&&a.blur();break;case O.Focus:c&&a.focus&&a.focus({preventScroll:!0});break;case O.Click:case O.TouchStart:case O.TouchEnd:case O.MouseDown:case O.MouseUp:n?(i.type===O.TouchStart?this.touchActive=!0:i.type===O.TouchEnd&&(this.touchActive=!1),i.type===O.MouseDown?this.lastMouseDownEvent=[a,s]:i.type===O.MouseUp&&(this.lastMouseDownEvent=null),this.mousePos={x:i.x,y:i.y,id:i.id,debugData:i}):(i.type===O.TouchStart&&(this.tailPositions.length=0),this.moveAndHover(i.x,i.y,i.id,n,i),i.type===O.Click?(this.mouse.classList.remove("active"),this.mouse.offsetWidth,this.mouse.classList.add("active")):i.type===O.TouchStart?(this.mouse.offsetWidth,this.mouse.classList.add("touch-active")):i.type===O.TouchEnd?this.mouse.classList.remove("touch-active"):a.dispatchEvent(s));break;case O.TouchCancel:n?this.touchActive=!1:this.mouse.classList.remove("touch-active");break;default:a.dispatchEvent(s)}break}case E.Scroll:{if(i.id===-1)break;if(this.usingVirtualDom){const s=this.virtualDom.mirror.getNode(i.id);if(!s)return this.debugNodeNotFound(i,i.id);s.scrollData=i;break}this.applyScroll(i,n);break}case E.ViewportResize:this.emitter.emit(L.Resize,{width:i.width,height:i.height});break;case E.Input:{if(i.id===-1)break;if(this.usingVirtualDom){const s=this.virtualDom.mirror.getNode(i.id);if(!s)return this.debugNodeNotFound(i,i.id);s.inputData=i;break}this.applyInput(i);break}case E.MediaInteraction:{const s=this.usingVirtualDom?this.virtualDom.mirror.getNode(i.id):this.mirror.getNode(i.id);if(!s)return this.debugNodeNotFound(i,i.id);const a=s;try{i.currentTime!==void 0&&(a.currentTime=i.currentTime),i.volume!==void 0&&(a.volume=i.volume),i.muted!==void 0&&(a.muted=i.muted),i.type===de.Pause&&a.pause(),i.type===de.Play&&a.play(),i.type===de.RateChange&&(a.playbackRate=i.playbackRate)}catch(c){this.warn(`Failed to replay media interactions: ${c.message||c}`)}break}case E.StyleSheetRule:case E.StyleDeclaration:{this.usingVirtualDom?i.styleId?this.constructedStyleMutations.push(i):i.id&&((o=this.virtualDom.mirror.getNode(i.id))==null||o.rules.push(i)):this.applyStyleSheetMutation(i);break}case E.CanvasMutation:{if(!this.config.UNSAFE_replayCanvas)return;if(this.usingVirtualDom){const s=this.virtualDom.mirror.getNode(i.id);if(!s)return this.debugNodeNotFound(i,i.id);s.canvasMutations.push({event:t,mutation:i})}else{const s=this.mirror.getNode(i.id);if(!s)return this.debugNodeNotFound(i,i.id);ar({event:t,mutation:i,target:s,imageMap:this.imageMap,canvasEventMap:this.canvasEventMap,errorHandler:this.warnCanvasMutationFailed.bind(this)})}break}case E.Font:{try{const s=new FontFace(i.family,i.buffer?new Uint8Array(JSON.parse(i.fontSource)):i.fontSource,i.descriptors);(l=this.iframe.contentDocument)==null||l.fonts.add(s)}catch(s){this.warn(s)}break}case E.Selection:{if(n){this.lastSelectionData=i;break}this.applySelection(i);break}case E.AdoptedStyleSheet:{this.usingVirtualDom?this.adoptedStyleSheets.push(i):this.applyAdoptedStyleSheet(i);break}}}applyMutation(t,n){if(this.config.useVirtualDom&&!this.usingVirtualDom&&n&&(this.usingVirtualDom=!0,bs(this.iframe.contentDocument,this.mirror,this.virtualDom),Object.keys(this.legacy_missingNodeRetryMap).length))for(const c in this.legacy_missingNodeRetryMap)try{const u=this.legacy_missingNodeRetryMap[c],d=Vn(u.node,this.virtualDom,this.mirror);d&&(u.node=d)}catch(u){this.warn(u)}const r=this.usingVirtualDom?this.virtualDom.mirror:this.mirror;t.removes=t.removes.filter(c=>r.getNode(c.id)?!0:(this.warnNodeNotFound(t,c.id),!1)),t.removes.forEach(c=>{var u;const d=r.getNode(c.id);if(!d)return;let h=r.getNode(c.parentId);if(!h)return this.warnNodeNotFound(t,c.parentId);if(c.isShadow&&me(h)&&(h=h.shadowRoot),r.removeNodeFromMap(d),h)try{h.removeChild(d),this.usingVirtualDom&&d.nodeName==="#text"&&h.nodeName==="STYLE"&&((u=h.rules)==null?void 0:u.length)>0&&(h.rules=[])}catch(m){if(m instanceof DOMException)this.warn("parent could not remove child in mutation",h,d,t);else throw m}});const o=at({},this.legacy_missingNodeRetryMap),l=[],i=c=>{let u=null;return c.nextId&&(u=r.getNode(c.nextId)),c.nextId!==null&&c.nextId!==void 0&&c.nextId!==-1&&!u},s=c=>{var u,d;if(!this.iframe.contentDocument)return this.warn("Looks like your replayer has been destroyed.");let h=r.getNode(c.parentId);if(!h)return c.node.type===T.Document?this.newDocumentQueue.push(c):l.push(c);c.node.isShadow&&(me(h)||h.attachShadow({mode:"open"}),h=h.shadowRoot);let m=null,y=null;if(c.previousId&&(m=r.getNode(c.previousId)),c.nextId&&(y=r.getNode(c.nextId)),i(c))return l.push(c);if(c.node.rootId&&!r.getNode(c.node.rootId))return;const p=c.node.rootId?r.getNode(c.node.rootId):this.usingVirtualDom?this.virtualDom:this.iframe.contentDocument;if(Ie(h,r)){this.attachDocumentToIframe(c,h);return}const v=(g,w)=>{if(!this.usingVirtualDom)for(const N of this.config.plugins||[])N.onBuild&&N.onBuild(g,{id:w,replayer:this})},f=$e(c.node,{doc:p,mirror:r,skipChild:!0,hackCss:!0,cache:this.cache,afterAppend:v});if(c.previousId===-1||c.nextId===-1){o[c.node.id]={node:f,mutation:c};return}const S=r.getMeta(h);if(S&&S.type===T.Element&&S.tagName==="textarea"&&c.node.type===T.Text){const g=Array.isArray(h.childNodes)?h.childNodes:Array.from(h.childNodes);for(const w of g)w.nodeType===h.TEXT_NODE&&h.removeChild(w)}else if(S?.type===T.Document){const g=h;c.node.type===T.DocumentType&&((u=g.childNodes[0])==null?void 0:u.nodeType)===Node.DOCUMENT_TYPE_NODE&&g.removeChild(g.childNodes[0]),f.nodeName==="HTML"&&g.documentElement&&g.removeChild(g.documentElement)}if(m&&m.nextSibling&&m.nextSibling.parentNode?h.insertBefore(f,m.nextSibling):y&&y.parentNode?h.contains(y)?h.insertBefore(f,y):h.insertBefore(f,null):h.appendChild(f),v(f,c.node.id),this.usingVirtualDom&&f.nodeName==="#text"&&h.nodeName==="STYLE"&&((d=h.rules)==null?void 0:d.length)>0&&(h.rules=[]),Ie(f,this.mirror)){const g=this.mirror.getId(f),w=this.newDocumentQueue.find(N=>N.parentId===g);w&&(this.attachDocumentToIframe(w,f),this.newDocumentQueue=this.newDocumentQueue.filter(N=>N!==w))}(c.previousId||c.nextId)&&this.legacy_resolveMissingNode(o,h,f,c)};t.adds.forEach(c=>{s(c)});const a=Date.now();for(;l.length;){const c=nn(l);if(l.length=0,Date.now()-a>500){this.warn("Timeout in the loop, please check the resolve tree data:",c);break}for(const u of c)r.getNode(u.value.parentId)?bt(u,d=>{s(d)}):this.debug("Drop resolve tree since there is no parent for the root node.",u)}Object.keys(o).length&&Object.assign(this.legacy_missingNodeRetryMap,o),rn(t.texts).forEach(c=>{var u;const d=r.getNode(c.id);if(!d)return t.removes.find(h=>h.id===c.id)?void 0:this.warnNodeNotFound(t,c.id);if(d.textContent=c.value,this.usingVirtualDom){const h=d.parentNode;((u=h?.rules)==null?void 0:u.length)>0&&(h.rules=[])}}),t.attributes.forEach(c=>{var u;const d=r.getNode(c.id);if(!d)return t.removes.find(h=>h.id===c.id)?void 0:this.warnNodeNotFound(t,c.id);for(const h in c.attributes)if(typeof h=="string"){const m=c.attributes[h];if(m===null)d.removeAttribute(h);else if(typeof m=="string")try{if(h==="_cssText"&&(d.nodeName==="LINK"||d.nodeName==="STYLE"))try{const y=r.getMeta(d);Object.assign(y.attributes,c.attributes);const p=$e(y,{doc:d.ownerDocument,mirror:r,skipChild:!0,hackCss:!0,cache:this.cache}),v=d.nextSibling,f=d.parentNode;if(p&&f){f.removeChild(d),f.insertBefore(p,v),r.replace(c.id,p);break}}catch{}if(h==="value"&&d.nodeName==="TEXTAREA"){const y=d;y.childNodes.forEach(v=>y.removeChild(v));const p=(u=d.ownerDocument)==null?void 0:u.createTextNode(m);p&&y.appendChild(p)}else d.setAttribute(h,m)}catch(y){this.warn("An error occurred may due to the checkout feature.",y)}else if(h==="style"){const y=m,p=d;for(const v in y)if(y[v]===!1)p.style.removeProperty(v);else if(y[v]instanceof Array){const f=y[v];p.style.setProperty(v,f[0],f[1])}else{const f=y[v];p.style.setProperty(v,f)}}}})}applyScroll(t,n){var r,o;const l=this.mirror.getNode(t.id);if(!l)return this.debugNodeNotFound(t,t.id);const i=this.mirror.getMeta(l);if(l===this.iframe.contentDocument)(r=this.iframe.contentWindow)==null||r.scrollTo({top:t.y,left:t.x,behavior:n?"auto":"smooth"});else if(i?.type===T.Document)(o=l.defaultView)==null||o.scrollTo({top:t.y,left:t.x,behavior:n?"auto":"smooth"});else try{l.scrollTo({top:t.y,left:t.x,behavior:n?"auto":"smooth"})}catch{}}applyInput(t){const n=this.mirror.getNode(t.id);if(!n)return this.debugNodeNotFound(t,t.id);try{n.checked=t.isChecked,n.value=t.text}catch{}}applySelection(t){try{const n=new Set,r=t.ranges.map(({start:o,startOffset:l,end:i,endOffset:s})=>{const a=this.mirror.getNode(o),c=this.mirror.getNode(i);if(!a||!c)return;const u=new Range;u.setStart(a,l),u.setEnd(c,s);const d=a.ownerDocument,h=d?.getSelection();return h&&n.add(h),{range:u,selection:h}});n.forEach(o=>o.removeAllRanges()),r.forEach(o=>{var l;return o&&((l=o.selection)==null?void 0:l.addRange(o.range))})}catch{}}applyStyleSheetMutation(t){var n;let r=null;t.styleId?r=this.styleMirror.getStyle(t.styleId):t.id&&(r=((n=this.mirror.getNode(t.id))==null?void 0:n.sheet)||null),r&&(t.source===E.StyleSheetRule?this.applyStyleSheetRule(t,r):t.source===E.StyleDeclaration&&this.applyStyleDeclaration(t,r))}applyStyleSheetRule(t,n){var r,o,l,i;if((r=t.adds)==null||r.forEach(({rule:s,index:a})=>{try{if(Array.isArray(a)){const{positions:c,index:u}=Ct(a);De(n.cssRules,c).insertRule(s,u)}else{const c=a===void 0?void 0:Math.min(a,n.cssRules.length);n?.insertRule(s,c)}}catch{}}),(o=t.removes)==null||o.forEach(({index:s})=>{try{if(Array.isArray(s)){const{positions:a,index:c}=Ct(s);De(n.cssRules,a).deleteRule(c||0)}else n?.deleteRule(s)}catch{}}),t.replace)try{(l=n.replace)==null||l.call(n,t.replace)}catch{}if(t.replaceSync)try{(i=n.replaceSync)==null||i.call(n,t.replaceSync)}catch{}}applyStyleDeclaration(t,n){t.set&&De(n.rules,t.index).style.setProperty(t.set.property,t.set.value,t.set.priority),t.remove&&De(n.rules,t.index).style.removeProperty(t.remove.property)}applyAdoptedStyleSheet(t){var n;const r=this.mirror.getNode(t.id);if(!r)return;(n=t.styles)==null||n.forEach(s=>{var a;let c=null,u=null;if(me(r)?u=((a=r.ownerDocument)==null?void 0:a.defaultView)||null:r.nodeName==="#document"&&(u=r.defaultView),!!u)try{c=new u.CSSStyleSheet,this.styleMirror.add(c,s.styleId),this.applyStyleSheetRule({source:E.StyleSheetRule,adds:s.rules},c)}catch{}});const o=10;let l=0;const i=(s,a)=>{const c=a.map(u=>this.styleMirror.getStyle(u)).filter(u=>u!==null);me(s)?s.shadowRoot.adoptedStyleSheets=c:s.nodeName==="#document"&&(s.adoptedStyleSheets=c),c.length!==a.length&&l<o&&(setTimeout(()=>i(s,a),0+100*l),l++)};i(r,t.styleIds)}legacy_resolveMissingNode(t,n,r,o){const{previousId:l,nextId:i}=o,s=l&&t[l],a=i&&t[i];if(s){const{node:c,mutation:u}=s;n.insertBefore(c,r),delete t[u.node.id],delete this.legacy_missingNodeRetryMap[u.node.id],(u.previousId||u.nextId)&&this.legacy_resolveMissingNode(t,n,c,u)}if(a){const{node:c,mutation:u}=a;n.insertBefore(c,r.nextSibling),delete t[u.node.id],delete this.legacy_missingNodeRetryMap[u.node.id],(u.previousId||u.nextId)&&this.legacy_resolveMissingNode(t,n,c,u)}}moveAndHover(t,n,r,o,l){const i=this.mirror.getNode(r);if(!i)return this.debugNodeNotFound(l,r);const s=Et(i,this.iframe),a=t*s.absoluteScale+s.x,c=n*s.absoluteScale+s.y;this.mouse.style.left=`${a}px`,this.mouse.style.top=`${c}px`,o||this.drawMouseTail({x:a,y:c}),this.hoverElements(i)}drawMouseTail(t){if(!this.mouseTail)return;const{lineCap:n,lineWidth:r,strokeStyle:o,duration:l}=this.config.mouseTail===!0?$t:Object.assign({},$t,this.config.mouseTail),i=()=>{if(!this.mouseTail)return;const s=this.mouseTail.getContext("2d");!s||!this.tailPositions.length||(s.clearRect(0,0,this.mouseTail.width,this.mouseTail.height),s.beginPath(),s.lineWidth=r,s.lineCap=n,s.strokeStyle=o,s.moveTo(this.tailPositions[0].x,this.tailPositions[0].y),this.tailPositions.forEach(a=>s.lineTo(a.x,a.y)),s.stroke())};this.tailPositions.push(t),i(),setTimeout(()=>{this.tailPositions=this.tailPositions.filter(s=>s!==t),i()},l/this.speedService.state.context.timer.speed)}hoverElements(t){var n;(n=this.lastHoveredRootNode||this.iframe.contentDocument)==null||n.querySelectorAll(".\\:hover").forEach(o=>{o.classList.remove(":hover")}),this.lastHoveredRootNode=t.getRootNode();let r=t;for(;r;)r.classList&&r.classList.add(":hover"),r=r.parentElement}isUserInteraction(t){return t.type!==M.IncrementalSnapshot?!1:t.data.source>E.Mutation&&t.data.source<=E.Input}backToNormal(){this.nextUserInteractionEvent=null,!this.speedService.state.matches("normal")&&(this.speedService.send({type:"BACK_TO_NORMAL"}),this.emitter.emit(L.SkipEnd,{speed:this.speedService.state.context.normalSpeed}))}warnNodeNotFound(t,n){this.warn(`Node with id '${n}' not found. `,t)}warnCanvasMutationFailed(t,n){this.warn("Has error on canvas update",n,"canvas mutation:",t)}debugNodeNotFound(t,n){this.debug(`Node with id '${n}' not found. `,t)}warn(...t){!this.config.showWarning||this.config.logger.warn(ur,...t)}debug(...t){!this.config.showDebug||this.config.logger.log(ur,...t)}}const{addCustomEvent:Ks}=Se,{freezePage:Zs}=Se;return q.EventType=M,q.IncrementalSource=E,q.MouseInteractions=O,q.Replayer=Js,q.ReplayerEvents=L,q.addCustomEvent=Ks,q.freezePage=Zs,q.record=Se,q.utils=Qr,Object.defineProperty(q,"__esModule",{value:!0}),q}({});
//# sourceMappingURL=fpweb.min.js.map
